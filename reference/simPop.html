<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Given a spatial risk model, simulate populations and population prevalences at the 
enumeration area level (represented as points), and aggregate to the pixel and 
administrative areal level."><title>Simulate populations and areal prevalences — simPop • SUMMER</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate populations and areal prevalences — simPop"><meta property="og:description" content="Given a spatial risk model, simulate populations and population prevalences at the 
enumeration area level (represented as points), and aggregate to the pixel and 
administrative areal level."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SUMMER</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/web_only/small-area-estimation.html">Generic small area estimation</a>
    <a class="dropdown-item" href="../articles/web_only/u5mr-vignette.html">Estimating Subnational U5MR using Simulated Data</a>
    <a class="dropdown-item" href="../articles/web_only/u5mr-dhs-vignette.html">Estimating Subnational U5MR using DHS Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/richardli/SUMMER/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulate populations and areal prevalences</h1>
      <small class="dont-index">Source: <a href="https://github.com/richardli/SUMMER/blob/HEAD/R/simPop.R" class="external-link"><code>R/simPop.R</code></a></small>
      <div class="d-none name"><code>simPop.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a spatial risk model, simulate populations and population prevalences at the 
enumeration area level (represented as points), and aggregate to the pixel and 
administrative areal level.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simPopSPDE</span><span class="op">(</span></span>
<span>  nsim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">easpa</span>,</span>
<span>  <span class="va">popMat</span>,</span>
<span>  <span class="va">targetPopMat</span>,</span>
<span>  <span class="va">poppsub</span>,</span>
<span>  <span class="va">spdeMesh</span>,</span>
<span>  margVar <span class="op">=</span> <span class="fl">0.243</span>,</span>
<span>  sigmaEpsilon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">0.463</span><span class="op">)</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">0.009</span>,</span>
<span>  effRange <span class="op">=</span> <span class="fl">406.51</span>,</span>
<span>  beta0 <span class="op">=</span> <span class="op">-</span><span class="fl">3.922</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inla.seed <span class="op">=</span> <span class="op">-</span><span class="fl">1L</span>,</span>
<span>  nHHSampled <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  stratifyByUrban <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  subareaLevel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  doFineScaleRisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  doSmoothRisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  doSmoothRiskLogisticApprox <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  min1PerSubarea <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">simPopCustom</span><span class="op">(</span></span>
<span>  <span class="va">logitRiskDraws</span>,</span>
<span>  <span class="va">sigmaEpsilonDraws</span>,</span>
<span>  <span class="va">easpa</span>,</span>
<span>  <span class="va">popMat</span>,</span>
<span>  <span class="va">targetPopMat</span>,</span>
<span>  stratifyByUrban <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  validationPixelI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  validationClusterI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  clustersPerPixel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doFineScaleRisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  doSmoothRisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  doSmoothRiskLogisticApprox <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  poppsub <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subareaLevel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  min1PerSubarea <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  returnEAinfo <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  epsc <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>nsim</dt>
<dd><p>Number of simulations</p></dd>


<dt>easpa</dt>
<dd><p>data.frame of enumeration area, households, and target population per area stratified by urban/rural with variables:</p><dl><dt>area</dt>
<dd><p>name of area</p></dd>

  <dt>EAUrb</dt>
<dd><p>number of urban enumeration areas in the area</p></dd>

  <dt>EARur</dt>
<dd><p>number of rural enumeration areas in the area</p></dd>

  <dt>EATotal</dt>
<dd><p>total number of enumeration areas in the area</p></dd>

  <dt>HHUrb</dt>
<dd><p>number of urban households in the area</p></dd>

  <dt>HHRur</dt>
<dd><p>number of rural households in the area</p></dd>

  <dt>HHTotal</dt>
<dd><p>total number of households in the area</p></dd>

  <dt>popUrb</dt>
<dd><p>total urban (target) population of area</p></dd>

  <dt>popRur</dt>
<dd><p>total rural (target) population of area</p></dd>

  <dt>popTotal</dt>
<dd><p>total (general) population of area</p></dd>


</dl></dd>


<dt>popMat</dt>
<dd><p>Pixellated grid data frame with variables `lon`, `lat`, `pop`, `area`, `subareas` (if subareaLevel is TRUE), `urban` (if stratifyByUrban is TRUE), `east`, and `north`</p></dd>


<dt>targetPopMat</dt>
<dd><p>Same as popMat, but `pop` variable gives target rather than general population</p></dd>


<dt>poppsub</dt>
<dd><p>data.frame of population per subarea separated by 
urban/rural using for population density grid normalization or urbanicity 
classification. Often based on extra fine scale population density grid. Has variables:</p></dd>


<dt>spdeMesh</dt>
<dd><p>Triangular mesh for the SPDE</p></dd>


<dt>margVar</dt>
<dd><p>Marginal variance of the spatial process, excluding cluster effects. 
If 0, no spatial component is included</p></dd>


<dt>sigmaEpsilon</dt>
<dd><p>Standard deviation on the logit scale for iid Gaussian EA level random effects in the risk model</p></dd>


<dt>gamma</dt>
<dd><p>Effect of urban on logit scale for logit model for risk</p></dd>


<dt>effRange</dt>
<dd><p>Effective spatial range for the SPDE model</p></dd>


<dt>beta0</dt>
<dd><p>Intercept of logit model for risk</p></dd>


<dt>seed</dt>
<dd><p>Random number generator seed</p></dd>


<dt>inla.seed</dt>
<dd><p>Seed input to inla.qsample. 0L sets seed intelligently, 
&gt; 0 sets a specific seed, &lt; 0 keeps existing RNG</p></dd>


<dt>nHHSampled</dt>
<dd><p>Number of households sampled per enumeration area. Default is 25 to match DHS surveys</p></dd>


<dt>stratifyByUrban</dt>
<dd><p>Whether or not to stratify simulations by urban/rural classification</p></dd>


<dt>subareaLevel</dt>
<dd><p>Whether or not to aggregate the population by subarea</p></dd>


<dt>doFineScaleRisk</dt>
<dd><p>Whether or not to calculate the fine scale risk at each aggregation level in addition to the prevalence</p></dd>


<dt>doSmoothRisk</dt>
<dd><p>Whether or not to calculate the smooth risk at each aggregation level in addition to the prevalence</p></dd>


<dt>doSmoothRiskLogisticApprox</dt>
<dd><p>Whether to use logistic approximation when calculating smooth risk. See 
<code><a href="logitNormMean.html">logitNormMean</a></code> for details.</p></dd>


<dt>min1PerSubarea</dt>
<dd><p>If TRUE, ensures there is at least 1 EA per subarea. If subareas are particularly unlikely to 
have enumeration areas since they have a very low proportion of the population in an area, then setting this to TRUE may be 
computationally intensive.</p></dd>


<dt>logitRiskDraws</dt>
<dd><p>nIntegrationPoints x nsim dimension matrix of draws from the pixel leve risk field on logit scale, leaving out 
potential nugget/cluster/EA level effects.</p></dd>


<dt>sigmaEpsilonDraws</dt>
<dd><p>nsim length vector of draws of cluster effect logit scale SD (joint draws with logitRiskDraws)</p></dd>


<dt>validationPixelI</dt>
<dd><p>CURRENTLY FOR TESTING PURPOSES ONLY a set of indices of pixels for which we want to simulate populations (used for pixel level validation)</p></dd>


<dt>validationClusterI</dt>
<dd><p>CURRENTLY FOR TESTING PURPOSES ONLY a set of indices of cluster for which we want to simulate populations (used for cluster level validation)</p></dd>


<dt>clustersPerPixel</dt>
<dd><p>CURRENTLY FOR TESTING PURPOSES ONLY Used for pixel level validation. Fixes the number of EAs per pixel.</p></dd>


<dt>returnEAinfo</dt>
<dd><p>If TRUE, returns information on every individual EA (BAU) for each simulated population</p></dd>


<dt>epsc</dt>
<dd><p>nEAs x nsim matrix of simulated EA (BAU) level iid effects representing fine scale variation in 
      risk. If NULL, they are simulated as iid Gaussian on a logit scale with 
      SD given by sigmaEpsilonDraws
list(pixelPop=outPixelLevel, subareaPop=outSubareaLevel, areaPop=outAreaLevel, logitRiskDraws=logitRiskDraws)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The simulated population aggregated to the enumeration area, 
pixel, subarea (generally Admin2), and area (generally Admin1) levels. Output includes:</p>
<dl><dt>pixelPop</dt>
<dd><p>A list of pixel level population aggregates</p></dd>

<dt>subareaPop</dt>
<dd><p>A list of `subarea` level population aggregates</p></dd>

<dt>areaPop</dt>
<dd><p>A list of `area` level population aggregates</p></dd>

</dl><p>Each of these contains population numerator and denominator as well as prevalence and risk 
information aggregated to the appropriate level.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For population simulation and aggregation, we consider three models: smooth  
risk, fine scale risk, and the fine scale prevalence. All will be described in detail 
in a paper in preparation. In the smooth risk model, pixel level risks are integrated 
with respect to target population density when producing areal estimates on a prespecified 
set of integration points. The target population may be, for example, neonatals rather 
than the general population. In the fine scale models, enumeration areas (EAs) are simulated as 
point locations and iid random effects in the EA level risk are allowed. EAs and populations are dispersed conditional on the (possibly 
approximately) known number of EAs, households, and target population at a particular 
areal level (these we call `areas`) using multilevel multinomial sampling, first 
sampling the EAs, then distributing households among the EAs, then the target population 
among the households. Any areal level below the `areas` we call `subareas`. For instance, 
the `areas` might be Admin-1 if that is the smallest level at which the number of EAs, 
households, and people is known, and the `subareas` might be Admin-2. The multilevel 
multinomial sampling may be stratified by urban/rural within the areas if the number of 
EAs, households, and people is also approximately known at that level.</p>
<p>Within each EA we assume a fixed probability of an event occurring, which is the fine scale `risk`. 
The fine scale `prevalence` is the empirical proportion of events within that EA. We assume EA 
level logit scale iid N(0, sigmaEpsilon^2) random effects in the risk model. When averaged 
with equal weights over all EAs in an areal unit, this forms the fine scale risk. When 
instead the population numerators and denominators are aggregated, and are used to 
calculate the empirical proportion of events occurring in an areal unit, the resulting 
quantity is the fine scale prevalence in that areal unit.</p>
<p>Note that these functions can be used for either simulating populations for simulation 
studies, or for generating predictions accounting for uncertainty in EA locations 
and fine scale variation occurring at the EA level due to EA level iid random effects. 
Required, however, is a separately fit EA level spatial risk model 
and information on the spatial population density and the population frame.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>simPopSPDE()</code>: Simulate populations and population prevalences given census frame and population density 
information. Uses SPDE model for generating spatial risk and can include iid cluster 
level effect.</p></li>
<li><p><code>simPopCustom()</code>: Simulate populations and population prevalences given census frame and population density 
information. Uses custom spatial logit risk function and can include iid cluster 
level effect.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>In preparation</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>simPopCustom</code>, <code><a href="makePopIntegrationTab.html">makePopIntegrationTab</a></code>, <code><a href="makePopIntegrationTab.html">adjustPopMat</a></code>, <code><a href="simSPDE.html">simSPDE</a></code>.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>John Paige</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## In this script we will create 5km resolution pixellated grid over Kenya, </span></span></span>
<span class="r-in"><span><span class="co">## and generate tables of estimated (both target and general) population </span></span></span>
<span class="r-in"><span><span class="co">## totals at the area (e.g. Admin-1) and subarea (e.g. Admin-2) levels. Then </span></span></span>
<span class="r-in"><span><span class="co">## we will use that to simulate populations of </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># download Kenya GADM shapefiles from SUMMERdata github repository</span></span></span>
<span class="r-in"><span><span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://github.com/paigejo/SUMMERdata/blob/main/data/"</span>, </span></span>
<span class="r-in"><span>                    <span class="st">"kenyaMaps.rda?raw=true"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tempDirectory</span> <span class="op">=</span> <span class="st">"~/"</span></span></span>
<span class="r-in"><span><span class="va">mapsFilename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"/kenyaMaps.rda"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">mapsFilename</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>,<span class="va">mapsFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load it in</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">mapsFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span></span></span>
<span class="r-in"><span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Trans Nzoia"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Trans-Nzoia"</span></span></span>
<span class="r-in"><span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Elgeyo-Marakwet"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Elgeyo Marakwet"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Trans Nzoia"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Trans-Nzoia"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Elgeyo-Marakwet"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Elgeyo Marakwet"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># some Admin-2 areas have the same name</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Bungoma"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Lugari"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Lugari, Bungoma"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Kakamega"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Lugari"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Lugari, Kakamega"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Meru"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Igembe South"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Igembe South, Meru"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Tharaka-Nithi"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Igembe South"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Igembe South, Tharaka-Nithi"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The spatial area of unknown 8 is so small, it causes problems unless its removed or </span></span></span>
<span class="r-in"><span><span class="co"># unioned with another subarea. Union it with neighboring Kakeguria:</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span> <span class="op">=</span> <span class="va">adm2</span></span></span>
<span class="r-in"><span><span class="va">unknown8I</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"unknown 8"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unknown 8"</span>, <span class="st">"Kapenguria"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> </span></span>
<span class="r-in"><span>  <span class="st">"Kapenguria + unknown 8"</span></span></span>
<span class="r-in"><span><span class="va">admin2.IDs</span> <span class="op">&lt;-</span> <span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span>, NAME_2OLD <span class="op">=</span> <span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2OLD</span> <span class="op">=</span> <span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">=</span> <span class="va">admin2.IDs</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">=</span> <span class="va">admin2.IDs</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">newadm2</span>, <span class="st">"SpatVector"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"NAME_2"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">as_Spatial</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tempData</span> <span class="op">=</span> <span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">unknown8I</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tempData</span> <span class="op">=</span> <span class="va">tempData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">tempData</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPolygons.html" class="external-link">SpatialPolygonsDataFrame</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">tempData</span>, match.ID <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2</span> <span class="op">=</span> <span class="va">newadm2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># download 2014 Kenya population density TIF file</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://github.com/paigejo/SUMMERdata/blob/main/data/"</span>, </span></span>
<span class="r-in"><span>                    <span class="st">"Kenya2014Pop/worldpop_total_1y_2014_00_00.tif?raw=true"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popTIFFilename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"/worldpop_total_1y_2014_00_00.tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">popTIFFilename</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>,<span class="va">popTIFFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load it in</span></span></span>
<span class="r-in"><span><span class="va">pop</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">popTIFFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">eastLim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">110.6405</span>, <span class="fl">832.4544</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">northLim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">555.1739</span>, <span class="fl">608.7130</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Construct poppsubKenya, a table of urban/rural general population totals </span></span></span>
<span class="r-in"><span><span class="co">## in each subarea. Technically, this is not necessary since we can load in </span></span></span>
<span class="r-in"><span><span class="co">## poppsubKenya via data(kenyaPopulationData). First, we will need to calculate </span></span></span>
<span class="r-in"><span><span class="co">## the areas in km^2 of the areas and subareas</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use Lambert equal area projection of areas (Admin-1) and subareas (Admin-2)</span></span></span>
<span class="r-in"><span><span class="va">midLon</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">@</span><span class="va">bbox</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">midLat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">@</span><span class="va">bbox</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p4s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"+proj=laea +x_0=0 +y_0=0 +lon_0="</span>, <span class="va">midLon</span>, </span></span>
<span class="r-in"><span>             <span class="st">" +lat_0="</span>, <span class="va">midLat</span>, <span class="st">" +units=km"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adm1_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm1proj_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">adm1_sf</span>, <span class="va">p4s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm1proj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">adm1proj_sf</span>, <span class="st">"Spatial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adm2_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">adm2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2proj_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">adm2_sf</span>, <span class="va">p4s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2proj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">adm2proj_sf</span>, <span class="st">"Spatial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now calculate spatial area in km^2</span></span></span>
<span class="r-in"><span><span class="va">admin1Areas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">adm1proj_sf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">admin2Areas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">adm2proj_sf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">areapaKenya</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">adm1proj</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span>, spatialArea<span class="op">=</span><span class="va">admin1Areas</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">areapsubKenya</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">adm2proj</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span>, subarea<span class="op">=</span><span class="va">adm2proj</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span>, </span></span>
<span class="r-in"><span>                           spatialArea<span class="op">=</span><span class="va">admin2Areas</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate general population totals at the subarea (Admin-2) x urban/rural </span></span></span>
<span class="r-in"><span><span class="co"># level and using 1km resolution population grid. Assign urbanicity by </span></span></span>
<span class="r-in"><span><span class="co"># thresholding population density based on estimated proportion population </span></span></span>
<span class="r-in"><span><span class="co"># urban/rural, making sure total area (Admin-1) urban/rural populations in </span></span></span>
<span class="r-in"><span><span class="co"># each area matches poppaKenya.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># NOTE: the following function will typically take ~15-20 minutes. Can speed up </span></span></span>
<span class="r-in"><span><span class="co">#       by setting kmRes to be higher, but we recommend fine resolution for </span></span></span>
<span class="r-in"><span><span class="co">#       this step, since it only needs to be done once.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">poppsubKenya</span> <span class="op">&lt;-</span> <span class="fu"><a href="makePopIntegrationTab.html">getPoppsub</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  kmRes<span class="op">=</span><span class="fl">1</span>, pop<span class="op">=</span><span class="va">pop</span>, domainMapDat<span class="op">=</span><span class="va">adm0</span>,</span></span>
<span class="r-in"><span>  eastLim<span class="op">=</span><span class="va">eastLim</span>, northLim<span class="op">=</span><span class="va">northLim</span>, mapProjection<span class="op">=</span><span class="va">projKenya</span>,</span></span>
<span class="r-in"><span>  poppa <span class="op">=</span> <span class="va">poppaKenya</span>, areapa<span class="op">=</span><span class="va">areapaKenya</span>, areapsub<span class="op">=</span><span class="va">areapsubKenya</span>, </span></span>
<span class="r-in"><span>  areaMapDat<span class="op">=</span><span class="va">adm1</span>, subareaMapDat<span class="op">=</span><span class="va">adm2</span>, </span></span>
<span class="r-in"><span>  areaNameVar <span class="op">=</span> <span class="st">"NAME_1"</span>, subareaNameVar<span class="op">=</span><span class="st">"NAME_2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now generate a general population integration table at 5km resolution, </span></span></span>
<span class="r-in"><span><span class="co"># based on subarea (Admin-2) x urban/rural population totals. This takes </span></span></span>
<span class="r-in"><span><span class="co"># ~1 minute</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">popMatKenya</span> <span class="op">&lt;-</span> <span class="fu"><a href="makePopIntegrationTab.html">makePopIntegrationTab</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  kmRes<span class="op">=</span><span class="fl">5</span>, pop<span class="op">=</span><span class="va">pop</span>, domainMapDat<span class="op">=</span><span class="va">adm0</span>,</span></span>
<span class="r-in"><span>  eastLim<span class="op">=</span><span class="va">eastLim</span>, northLim<span class="op">=</span><span class="va">northLim</span>, mapProjection<span class="op">=</span><span class="va">projKenya</span>,</span></span>
<span class="r-in"><span>  poppa <span class="op">=</span> <span class="va">poppaKenya</span>, poppsub<span class="op">=</span><span class="va">poppsubKenya</span>, </span></span>
<span class="r-in"><span>  areaMapDat <span class="op">=</span> <span class="va">adm1</span>, subareaMapDat <span class="op">=</span> <span class="va">adm2</span>,</span></span>
<span class="r-in"><span>  areaNameVar <span class="op">=</span> <span class="st">"NAME_1"</span>, subareaNameVar<span class="op">=</span><span class="st">"NAME_2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Adjust popMat to be target (neonatal) rather than general population </span></span></span>
<span class="r-in"><span><span class="co">## density. First create the target population frame</span></span></span>
<span class="r-in"><span><span class="co">## (these numbers are based on IPUMS microcensus data)</span></span></span>
<span class="r-in"><span><span class="va">mothersPerHouseholdUrb</span> <span class="op">=</span> <span class="fl">0.3497151</span></span></span>
<span class="r-in"><span><span class="va">childrenPerMotherUrb</span> <span class="op">=</span> <span class="fl">1.295917</span></span></span>
<span class="r-in"><span><span class="va">mothersPerHouseholdRur</span> <span class="op">=</span> <span class="fl">0.4787696</span></span></span>
<span class="r-in"><span><span class="va">childrenPerMotherRur</span> <span class="op">=</span> <span class="fl">1.455222</span></span></span>
<span class="r-in"><span><span class="va">targetPopPerStratumUrban</span> <span class="op">=</span> <span class="va">easpaKenya</span><span class="op">$</span><span class="va">HHUrb</span> <span class="op">*</span> <span class="va">mothersPerHouseholdUrb</span> <span class="op">*</span> </span></span>
<span class="r-in"><span>  <span class="va">childrenPerMotherUrb</span></span></span>
<span class="r-in"><span><span class="va">targetPopPerStratumRural</span> <span class="op">=</span> <span class="va">easpaKenya</span><span class="op">$</span><span class="va">HHRur</span> <span class="op">*</span> <span class="va">mothersPerHouseholdRur</span> <span class="op">*</span> </span></span>
<span class="r-in"><span>  <span class="va">childrenPerMotherRur</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span> <span class="op">=</span> <span class="va">easpaKenya</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popUrb</span> <span class="op">=</span> <span class="va">targetPopPerStratumUrban</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popRur</span> <span class="op">=</span> <span class="va">targetPopPerStratumRural</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span> <span class="op">=</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popUrb</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>  <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popRur</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">pctUrb</span> <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popUrb</span> <span class="op">/</span> </span></span>
<span class="r-in"><span>  <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">pctTotal</span> <span class="op">=</span> </span></span>
<span class="r-in"><span>  <span class="fl">100</span> <span class="op">*</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the target population density by scaling the current </span></span></span>
<span class="r-in"><span><span class="co"># population density grid at the Admin1 x urban/rural level</span></span></span>
<span class="r-in"><span><span class="va">popMatKenyaNeonatal</span> <span class="op">=</span> <span class="fu"><a href="makePopIntegrationTab.html">adjustPopMat</a></span><span class="op">(</span><span class="va">popMatKenya</span>, <span class="va">easpaKenyaNeonatal</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate neonatal population table from the neonatal population integration </span></span></span>
<span class="r-in"><span><span class="co"># matrix. This is technically not necessary for population simulation purposes, </span></span></span>
<span class="r-in"><span><span class="co"># but is here for illustrative purposes</span></span></span>
<span class="r-in"><span><span class="va">poppsubKenyaNeonatal</span> <span class="op">=</span> <span class="fu"><a href="poppRegionFromPopMat.html">poppRegionFromPopMat</a></span><span class="op">(</span><span class="va">popMatKenyaNeonatal</span>, </span></span>
<span class="r-in"><span>                                            <span class="va">popMatKenyaNeonatal</span><span class="op">$</span><span class="va">subarea</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">poppsubKenyaNeonatal</span> <span class="op">=</span> </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>subarea<span class="op">=</span><span class="va">poppsubKenyaNeonatal</span><span class="op">$</span><span class="va">region</span>, </span></span>
<span class="r-in"><span>        area<span class="op">=</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">poppsubKenyaNeonatal</span><span class="op">$</span><span class="va">region</span>, <span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>        <span class="va">poppsubKenyaNeonatal</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">poppsubKenyaNeonatal</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Now we're ready to simulate neonatal populations along with neonatal </span></span></span>
<span class="r-in"><span><span class="co">## mortality risks and prevalences</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use the following model to simulate the neonatal population based roughly </span></span></span>
<span class="r-in"><span><span class="co"># on Paige et al. (2020) neonatal mortality modeling for Kenya.</span></span></span>
<span class="r-in"><span><span class="va">beta0</span><span class="op">=</span><span class="op">-</span><span class="fl">2.9</span> <span class="co"># intercept</span></span></span>
<span class="r-in"><span><span class="va">gamma</span><span class="op">=</span><span class="op">-</span><span class="fl">1</span> <span class="co"># urban effect</span></span></span>
<span class="r-in"><span><span class="va">rho</span><span class="op">=</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="co"># spatial variance</span></span></span>
<span class="r-in"><span><span class="va">effRange</span> <span class="op">=</span> <span class="fl">400</span> <span class="co"># effective spatial range in km</span></span></span>
<span class="r-in"><span><span class="va">sigmaEpsilon</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2.5</span><span class="op">)</span> <span class="co"># cluster (nugget) effect standard deviation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run a simulation! This produces multiple dense nEA x nsim and nPixel x nsim </span></span></span>
<span class="r-in"><span><span class="co"># matrices. In the future sparse matrices and chunk by chunk computations </span></span></span>
<span class="r-in"><span><span class="co"># may be incorporated.</span></span></span>
<span class="r-in"><span><span class="va">simPop</span> <span class="op">=</span> <span class="fu">simPopSPDE</span><span class="op">(</span>nsim<span class="op">=</span><span class="fl">1</span>, easpa<span class="op">=</span><span class="va">easpaKenyaNeonatal</span>, </span></span>
<span class="r-in"><span>                    popMat<span class="op">=</span><span class="va">popMatKenya</span>, targetPopMat<span class="op">=</span><span class="va">popMatKenyaNeonatal</span>, </span></span>
<span class="r-in"><span>                    poppsub<span class="op">=</span><span class="va">poppsubKenya</span>, spdeMesh<span class="op">=</span><span class="va">kenyaMesh</span>, </span></span>
<span class="r-in"><span>                    margVar<span class="op">=</span><span class="va">rho</span>, sigmaEpsilon<span class="op">=</span><span class="va">sigmaEpsilon</span>, </span></span>
<span class="r-in"><span>                    gamma<span class="op">=</span><span class="va">gamma</span>, effRange<span class="op">=</span><span class="va">effRange</span>, beta0<span class="op">=</span><span class="va">beta0</span>, </span></span>
<span class="r-in"><span>                    seed<span class="op">=</span><span class="fl">12</span>, inla.seed<span class="op">=</span><span class="fl">12</span>, nHHSampled<span class="op">=</span><span class="fl">25</span>, </span></span>
<span class="r-in"><span>                    stratifyByUrban<span class="op">=</span><span class="cn">TRUE</span>, subareaLevel<span class="op">=</span><span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>                    doFineScaleRisk<span class="op">=</span><span class="cn">TRUE</span>, doSmoothRisk<span class="op">=</span><span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>                    min1PerSubarea<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get average absolute percent error relative to fine scale prevalence at Admin-2 level</span></span></span>
<span class="r-in"><span><span class="va">tempDat</span> <span class="op">=</span> <span class="va">simPop</span><span class="op">$</span><span class="va">subareaPop</span><span class="op">$</span><span class="va">aggregationResults</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"pFineScalePrevalence"</span>, </span></span>
<span class="r-in"><span>                                                  <span class="st">"pFineScaleRisk"</span>, <span class="st">"pSmoothRisk"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScalePrevalence</span> <span class="op">-</span> <span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScaleRisk</span><span class="op">)</span> <span class="op">/</span> </span></span>
<span class="r-in"><span>           <span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScalePrevalence</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScalePrevalence</span> <span class="op">-</span> <span class="va">tempDat</span><span class="op">$</span><span class="va">pSmoothRisk</span><span class="op">)</span> <span class="op">/</span> </span></span>
<span class="r-in"><span>           <span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScalePrevalence</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScaleRisk</span> <span class="op">-</span> <span class="va">tempDat</span><span class="op">$</span><span class="va">pSmoothRisk</span><span class="op">)</span> <span class="op">/</span> </span></span>
<span class="r-in"><span>           <span class="va">tempDat</span><span class="op">$</span><span class="va">pFineScalePrevalence</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># verify number of EAs per area and subarea</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">simPop</span><span class="op">$</span><span class="va">eaPop</span><span class="op">$</span><span class="va">eaSamples</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">popMatKenya</span><span class="op">$</span><span class="va">area</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">sum</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>      trueNumEAs<span class="op">=</span><span class="va">easpaKenya</span><span class="op">$</span><span class="va">EATotal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">easpaKenya</span><span class="op">$</span><span class="va">area</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">simPop</span><span class="op">$</span><span class="va">eaPop</span><span class="op">$</span><span class="va">eaSamples</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">popMatKenya</span><span class="op">$</span><span class="va">subarea</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">sum</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot simulated population</span></span></span>
<span class="r-in"><span><span class="co"># directory for plotting </span></span></span>
<span class="r-in"><span><span class="co"># (mapPlot takes longer when it doesn't save to a file)</span></span></span>
<span class="r-in"><span><span class="va">tempDirectory</span> <span class="op">=</span> <span class="st">"~/"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># pixel level plots. Some pixels have no simulated EAs, in which case they will be </span></span></span>
<span class="r-in"><span><span class="co"># plotted as white. Expected noisy looking plots of fine scale risk and prevalence </span></span></span>
<span class="r-in"><span><span class="co"># due to EAs being discrete, as compared to a very smooth plot of smooth risk.</span></span></span>
<span class="r-in"><span><span class="va">zlim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span>probs<span class="op">=</span><span class="fl">.995</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">simPop</span><span class="op">$</span><span class="va">pixelPop</span><span class="op">$</span><span class="va">pFineScalePrevalence</span>, </span></span>
<span class="r-in"><span>                                   <span class="va">simPop</span><span class="op">$</span><span class="va">pixelPop</span><span class="op">$</span><span class="va">pFineScaleRisk</span>, </span></span>
<span class="r-in"><span>                                   <span class="va">simPop</span><span class="op">$</span><span class="va">pixelPop</span><span class="op">$</span><span class="va">pSmoothRisk</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"simPopSPDEPixel.pdf"</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">8</span>, height<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm2</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">simPop</span><span class="op">$</span><span class="va">eaPop</span><span class="op">$</span><span class="va">eaDatList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">lon</span>, <span class="va">simPop</span><span class="op">$</span><span class="va">eaPop</span><span class="op">$</span><span class="va">eaDatList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">lat</span>, pch<span class="op">=</span><span class="st">"."</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm2</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">popMatKenya</span><span class="op">$</span><span class="va">lon</span>, <span class="va">popMatKenya</span><span class="op">$</span><span class="va">lat</span>, <span class="va">simPop</span><span class="op">$</span><span class="va">pixelPop</span><span class="op">$</span><span class="va">pFineScalePrevalence</span>, </span></span>
<span class="r-in"><span>           zlim<span class="op">=</span><span class="va">zlim</span>, add<span class="op">=</span><span class="cn">TRUE</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm2</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">popMatKenya</span><span class="op">$</span><span class="va">lon</span>, <span class="va">popMatKenya</span><span class="op">$</span><span class="va">lat</span>, <span class="va">simPop</span><span class="op">$</span><span class="va">pixelPop</span><span class="op">$</span><span class="va">pFineScaleRisk</span>, </span></span>
<span class="r-in"><span>           zlim<span class="op">=</span><span class="va">zlim</span>, add<span class="op">=</span><span class="cn">TRUE</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">popMatKenya</span><span class="op">$</span><span class="va">lon</span>, <span class="va">popMatKenya</span><span class="op">$</span><span class="va">lat</span>, <span class="va">simPop</span><span class="op">$</span><span class="va">pixelPop</span><span class="op">$</span><span class="va">pSmoothRisk</span>, </span></span>
<span class="r-in"><span>           zlim<span class="op">=</span><span class="va">zlim</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">}</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm2</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">simPop</span><span class="op">$</span><span class="va">eaPop</span><span class="op">$</span><span class="va">eaDatList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># areal (Admin-1) level: these results should look essentially identical</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tempDat</span> <span class="op">=</span> <span class="va">simPop</span><span class="op">$</span><span class="va">areaPop</span><span class="op">$</span><span class="va">aggregationResults</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"pFineScalePrevalence"</span>, </span></span>
<span class="r-in"><span>                                               <span class="st">"pFineScaleRisk"</span>, <span class="st">"pSmoothRisk"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"simPopSPDEAdmin-1.pdf"</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">7</span>, height<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mapPlot.html">mapPlot</a></span><span class="op">(</span><span class="va">tempDat</span>, </span></span>
<span class="r-in"><span>        variables<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pFineScalePrevalence"</span>, <span class="st">"pFineScaleRisk"</span>, <span class="st">"pSmoothRisk"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        geo<span class="op">=</span><span class="va">adm1</span>, by.geo<span class="op">=</span><span class="st">"NAME_1"</span>, by.data<span class="op">=</span><span class="st">"region"</span>, is.long<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># subareal (Admin-2) level: these results should look subtley different </span></span></span>
<span class="r-in"><span><span class="co"># depending on the type of prevalence/risk considered</span></span></span>
<span class="r-in"><span><span class="va">tempDat</span> <span class="op">=</span> <span class="va">simPop</span><span class="op">$</span><span class="va">subareaPop</span><span class="op">$</span><span class="va">aggregationResults</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"pFineScalePrevalence"</span>, </span></span>
<span class="r-in"><span>                                                  <span class="st">"pFineScaleRisk"</span>, <span class="st">"pSmoothRisk"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"simPopSPDEAdmin-2.pdf"</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">7</span>, height<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mapPlot.html">mapPlot</a></span><span class="op">(</span><span class="va">tempDat</span>, </span></span>
<span class="r-in"><span>        variables<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pFineScalePrevalence"</span>, <span class="st">"pFineScaleRisk"</span>, <span class="st">"pSmoothRisk"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        geo<span class="op">=</span><span class="va">adm2</span>, by.geo<span class="op">=</span><span class="st">"NAME_2"</span>, by.data<span class="op">=</span><span class="st">"region"</span>, is.long<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Zehang R Li, Bryan D Martin, Yuan Hsiao, Jessica Godwin, John Paige, Peter Gao, Jon Wakefield, Samuel J Clark, Geir-Arne Fuglstad, Andrea Riebler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

