<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Functions for generating pixellated population information and 
population frames at the `area` and `subarea` levels.  
The `area` and `subarea` levels can be thought of as big 
regions and little regions, where areas can be partitioned into 
unique sets of subareas. For example, Admin-1 and Admin-2 
areas might be areas and subareas respectively. The population totals are either 
tabulated at the area x urban/rural level, the subarea x urban/rural 
level, or at the pixel level of a specified resolution. Totals 
are calculated using population density information, shapefiles, 
and, possibly, preexisting population frames at different 
areal levels. Note that area names should each be unique, and similarly for 
subarea names."><title>Generating pixellated populations, and population frames — makePopIntegrationTab • SUMMER</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating pixellated populations, and population frames — makePopIntegrationTab"><meta property="og:description" content="Functions for generating pixellated population information and 
population frames at the `area` and `subarea` levels.  
The `area` and `subarea` levels can be thought of as big 
regions and little regions, where areas can be partitioned into 
unique sets of subareas. For example, Admin-1 and Admin-2 
areas might be areas and subareas respectively. The population totals are either 
tabulated at the area x urban/rural level, the subarea x urban/rural 
level, or at the pixel level of a specified resolution. Totals 
are calculated using population density information, shapefiles, 
and, possibly, preexisting population frames at different 
areal levels. Note that area names should each be unique, and similarly for 
subarea names."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SUMMER</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/web_only/small-area-estimation.html">Generic small area estimation</a>
    <a class="dropdown-item" href="../articles/web_only/u5mr-vignette.html">Estimating Subnational U5MR using Simulated Data</a>
    <a class="dropdown-item" href="../articles/web_only/u5mr-dhs-vignette.html">Estimating Subnational U5MR using DHS Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/richardli/SUMMER/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Generating pixellated populations, and population frames</h1>
      <small class="dont-index">Source: <a href="https://github.com/richardli/SUMMER/blob/HEAD/R/popGrid.R" class="external-link"><code>R/popGrid.R</code></a></small>
      <div class="d-none name"><code>makePopIntegrationTab.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Functions for generating pixellated population information and 
population frames at the `area` and `subarea` levels.  
The `area` and `subarea` levels can be thought of as big 
regions and little regions, where areas can be partitioned into 
unique sets of subareas. For example, Admin-1 and Admin-2 
areas might be areas and subareas respectively. The population totals are either 
tabulated at the area x urban/rural level, the subarea x urban/rural 
level, or at the pixel level of a specified resolution. Totals 
are calculated using population density information, shapefiles, 
and, possibly, preexisting population frames at different 
areal levels. Note that area names should each be unique, and similarly for 
subarea names.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">makePopIntegrationTab</span><span class="op">(</span></span>
<span>  kmRes <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="va">pop</span>,</span>
<span>  <span class="va">domainMapDat</span>,</span>
<span>  <span class="va">eastLim</span>,</span>
<span>  <span class="va">northLim</span>,</span>
<span>  <span class="va">mapProjection</span>,</span>
<span>  <span class="va">areaMapDat</span>,</span>
<span>  <span class="va">subareaMapDat</span>,</span>
<span>  areaNameVar <span class="op">=</span> <span class="st">"NAME_1"</span>,</span>
<span>  subareaNameVar <span class="op">=</span> <span class="st">"NAME_2"</span>,</span>
<span>  poppa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  poppsub <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stratifyByUrban <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  areapa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  areapsub <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  customSubsetPolygons <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  areaPolygonSubsetI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subareaPolygonSubsetI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mean.neighbor <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  returnPoppTables <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  setNAsToZero <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fixZeroPopDensitySubareas <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extractMethod <span class="op">=</span> <span class="st">"bilinear"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">getPoppsub</span><span class="op">(</span></span>
<span>  kmRes <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">pop</span>,</span>
<span>  <span class="va">domainMapDat</span>,</span>
<span>  <span class="va">eastLim</span>,</span>
<span>  <span class="va">northLim</span>,</span>
<span>  <span class="va">mapProjection</span>,</span>
<span>  <span class="va">poppa</span>,</span>
<span>  areapa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">areapsub</span>,</span>
<span>  <span class="va">subareaMapDat</span>,</span>
<span>  subareaNameVar <span class="op">=</span> <span class="st">"NAME_2"</span>,</span>
<span>  stratifyByUrban <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  areaMapDat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  areaNameVar <span class="op">=</span> <span class="st">"NAME_1"</span>,</span>
<span>  areaPolygonSubsetI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subareaPolygonSubsetI <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  customSubsetPolygons <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mean.neighbor <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  setNAsToZero <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fixZeroPopDensitySubareas <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">adjustPopMat</span><span class="op">(</span></span>
<span>  <span class="va">popMat</span>,</span>
<span>  poppaTarget <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  adjustBy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area"</span>, <span class="st">"subarea"</span><span class="op">)</span>,</span>
<span>  stratifyByUrban <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>kmRes</dt>
<dd><p>The resolution of the pixelated grid in km</p></dd>


<dt>pop</dt>
<dd><p>Population density raster</p></dd>


<dt>domainMapDat</dt>
<dd><p>A shapefile representing the full spatial domain (e.g. country)</p></dd>


<dt>eastLim</dt>
<dd><p>Range in km easting over the spatial domain under the input projection</p></dd>


<dt>northLim</dt>
<dd><p>Range in km northing over the spatial domain under the input projection</p></dd>


<dt>mapProjection</dt>
<dd><p>A projection function taking longitude and latitude and returning easting and 
northing in km. Or the inverse if inverse is set to TRUE. For example, 
<code><a href="projKenya.html">projKenya</a></code>. Check https://epsg.io/ for example for best projection EPSG codes 
for specific countries</p></dd>


<dt>areaMapDat</dt>
<dd><p>SpatialPolygonsDataFrame object with area level map information</p></dd>


<dt>subareaMapDat</dt>
<dd><p>SpatialPolygonsDataFrame object with subarea level map information</p></dd>


<dt>areaNameVar</dt>
<dd><p>The name of the area variable associated with <code>areaMapDat@data</code> 
and <code>subareaMapDat@data</code></p></dd>


<dt>subareaNameVar</dt>
<dd><p>The name of the subarea variable associated with <code>subareaMapDat@data</code></p></dd>


<dt>poppa</dt>
<dd><p>data.frame of population per area separated by urban/rural. If `poppsub` 
  is not included, this is used for normalization of populations associated with 
  population integration points. Contains variables:</p><dl><dt>area</dt>
<dd><p>name of area</p></dd>

  <dt>popUrb</dt>
<dd><p>total urban (general) population of area</p></dd>

  <dt>popRur</dt>
<dd><p>total rural (general) population of area</p></dd>

  <dt>popTotal</dt>
<dd><p>total (general) population of area</p></dd>

  <dt>pctUrb</dt>
<dd><p>percentage of population in the area that is urban (between 0 and 100)</p></dd>


</dl></dd>


<dt>poppsub</dt>
<dd><p>data.frame of population per subarea separated by 
urban/rural using for population normalization or urbanicity 
classification. Often based on extra fine scale population density grid. 
Has variables:</p><dl><dt>subarea</dt>
<dd><p>name of subarea</p></dd>

  <dt>area</dt>
<dd><p>name of area</p></dd>

  <dt>popUrb</dt>
<dd><p>total urban (general) population of subarea</p></dd>

  <dt>popRur</dt>
<dd><p>total rural (general) population of subarea</p></dd>

  <dt>popTotal</dt>
<dd><p>total (general) population of subarea</p></dd>

  <dt>pctUrb</dt>
<dd><p>percentage of population in the subarea that is urban (between 0 and 100)</p></dd>


</dl></dd>


<dt>stratifyByUrban</dt>
<dd><p>Whether to stratify the pixellated grid by urban/rural. If TRUE, 
renormalizes population densities within areas or subareas crossed with urban/rural</p></dd>


<dt>areapa</dt>
<dd><p>A list with variables:</p><dl><dt>area</dt>
<dd><p>name of area</p></dd>

  <dt>spatialArea</dt>
<dd><p>spatial area of the subarea (e.g. in km^2)</p></dd>


</dl></dd>


<dt>areapsub</dt>
<dd><p>A list with variables:</p><dl><dt>subarea</dt>
<dd><p>name of subarea</p></dd>

  <dt>spatialArea</dt>
<dd><p>spatial area of the subarea (e.g. in km^2)</p></dd>


</dl></dd>


<dt>customSubsetPolygons</dt>
<dd><p>'SpatialPolygonsDataFrame' or 'SpatialPolygons' object to subset 
the grid over. This option can help reduce computation time relative to 
constructing the whole grid and subsetting afterwards. `areaPolygonSubsetI` or 
`subareaPolygonSubsetI` can be used when subsetting by areas or subareas in 
`areaMapDat` or `subareaMapDat`. Must be in latitude/longitude projection "EPSG:4326"</p></dd>


<dt>areaPolygonSubsetI</dt>
<dd><p>Index in areaMapDat for a specific area to subset the grid over. This 
option can help reduce computation time relative to constructing the whole grid 
and subsetting afterwards</p></dd>


<dt>subareaPolygonSubsetI</dt>
<dd><p>FOR EXPERIMENTAL PURPOSES ONLY. Index in subareaMapDat for a 
specific area to subset the grid over. This 
option can help reduce computation time relative to constructing the whole grid 
and subsetting afterwards</p></dd>


<dt>mean.neighbor</dt>
<dd><p>For determining what area or subarea points are nearest to if they do not 
directly fall into an area. See <code><a href="https://rdrr.io/pkg/fields/man/rdist.html" class="external-link">fields.rdist.near</a></code> for details.</p></dd>


<dt>delta</dt>
<dd><p>For determining what area or subarea points are nearest to if they do not 
directly fall into an area. See <code><a href="https://rdrr.io/pkg/fields/man/rdist.html" class="external-link">fields.rdist.near</a></code> for details.</p></dd>


<dt>returnPoppTables</dt>
<dd><p>If TRUE, poppa and poppsub will be calculated based on the generated 
population integration matrix and input area/subarea map data</p></dd>


<dt>setNAsToZero</dt>
<dd><p>If TRUE, sets NA populations to 0.</p></dd>


<dt>fixZeroPopDensitySubareas</dt>
<dd><p>If TRUE, if population density in a subarea is estimated to be 
zero, but the total population in the subarea is nonzero, population is filled into the 
area uniformly</p></dd>


<dt>extractMethod</dt>
<dd><p>Either 'bilinear' or 'simple'. see `method` from 
<code><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></code></p></dd>


<dt>popMat</dt>
<dd><p>Pixellated grid data frame with variables `area` and `pop` such as that 
generated by <code>makePopIntegrationTab</code></p></dd>


<dt>poppaTarget</dt>
<dd><p>Target population per area stratified by urban rural. Same format as poppa</p></dd>


<dt>adjustBy</dt>
<dd><p>Whether to adjust population density by the `area` or `subarea` level</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>makePopIntegrationTab()</code>: Generate pixellated `grid` of coordinates (both longitude/latitude and east/north) 
over spatial domain of the given resolution with associated population totals, areas, subareas, 
and urban/rural levels. For very small areas that might not 
otherwise have a grid point in them, a custom integration point is added at their 
centroid. Sets urbanicity classifications by thresholding input population density raster 
using area and subarea population tables, and generates area and subarea population 
tables from population density information if not already given. Can be used for integrating 
predictions from the given coordinates to area and subarea levels using population weights.</p></li>
<li><p><code>getPoppsub()</code>: Generate table of estimates of population
totals per subarea x urban/rural combination based on population density
raster at `kmres` resolution "grid", including custom integration points
for any subarea too small to include grid points at their centroids.</p></li>
<li><p><code>adjustPopMat()</code>: Adjust population densities in grid based on a population frame.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="setThresholdsByRegion.html">setThresholdsByRegion</a></code>, <code><a href="poppRegionFromPopMat.html">poppRegionFromPopMat</a></code>, <code><a href="simPop.html">simPopSPDE</a></code>, <code><a href="simPop.html">simPopCustom</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>John Paige</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># download Kenya GADM shapefiles from SUMMERdata github repository</span></span></span>
<span class="r-in"><span><span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://github.com/paigejo/SUMMERdata/blob/main/data/"</span>, </span></span>
<span class="r-in"><span>                    <span class="st">"kenyaMaps.rda?raw=true"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tempDirectory</span> <span class="op">=</span> <span class="st">"~/"</span></span></span>
<span class="r-in"><span><span class="va">mapsFilename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"/kenyaMaps.rda"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">mapsFilename</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>,<span class="va">mapsFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load it in</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">mapsFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span></span></span>
<span class="r-in"><span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Trans Nzoia"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Trans-Nzoia"</span></span></span>
<span class="r-in"><span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm1</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Elgeyo-Marakwet"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Elgeyo Marakwet"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Trans Nzoia"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Trans-Nzoia"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Elgeyo-Marakwet"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Elgeyo Marakwet"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># some Admin-2 areas have the same name</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Bungoma"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Lugari"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Lugari, Bungoma"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Kakamega"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Lugari"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Lugari, Kakamega"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Meru"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Igembe South"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Igembe South, Meru"</span></span></span>
<span class="r-in"><span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span> <span class="op">==</span> <span class="st">"Tharaka-Nithi"</span><span class="op">)</span> <span class="op">&amp;</span> </span></span>
<span class="r-in"><span>                   <span class="op">(</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"Igembe South"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Igembe South, Tharaka-Nithi"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The spatial area of unknown 8 is so small, it causes problems unless its removed or </span></span></span>
<span class="r-in"><span><span class="co"># unioned with another subarea. Union it with neighboring Kakeguria:</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span> <span class="op">=</span> <span class="va">adm2</span></span></span>
<span class="r-in"><span><span class="va">unknown8I</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">==</span> <span class="st">"unknown 8"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">[</span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unknown 8"</span>, <span class="st">"Kapenguria"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> </span></span>
<span class="r-in"><span>  <span class="st">"Kapenguria + unknown 8"</span></span></span>
<span class="r-in"><span><span class="va">admin2.IDs</span> <span class="op">&lt;-</span> <span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span>, NAME_2OLD <span class="op">=</span> <span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2OLD</span> <span class="op">=</span> <span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">=</span> <span class="va">admin2.IDs</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span><span class="op">$</span><span class="va">NAME_2</span> <span class="op">=</span> <span class="va">admin2.IDs</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">newadm2</span>, <span class="st">"SpatVector"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"NAME_2"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/coerce-methods.html" class="external-link">as_Spatial</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tempData</span> <span class="op">=</span> <span class="va">newadm2</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">unknown8I</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tempData</span> <span class="op">=</span> <span class="va">tempData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">tempData</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">newadm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/SpatialPolygons.html" class="external-link">SpatialPolygonsDataFrame</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">tempData</span>, match.ID <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2</span> <span class="op">=</span> <span class="va">newadm2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># download 2014 Kenya population density TIF file</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">githubURL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://github.com/paigejo/SUMMERdata/blob/main/data/"</span>, </span></span>
<span class="r-in"><span>                    <span class="st">"Kenya2014Pop/worldpop_total_1y_2014_00_00.tif?raw=true"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">popTIFFilename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tempDirectory</span>, <span class="st">"/worldpop_total_1y_2014_00_00.tif"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">popTIFFilename</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">githubURL</span>,<span class="va">popTIFFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load it in</span></span></span>
<span class="r-in"><span><span class="va">pop</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">popTIFFilename</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">eastLim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">110.6405</span>, <span class="fl">832.4544</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">northLim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">555.1739</span>, <span class="fl">608.7130</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Construct poppsubKenya, a table of urban/rural general population totals </span></span></span>
<span class="r-in"><span><span class="co">## in each subarea. Technically, this is not necessary since we can load in </span></span></span>
<span class="r-in"><span><span class="co">## poppsubKenya via data(kenyaPopulationData). First, we will need to calculate </span></span></span>
<span class="r-in"><span><span class="co">## the areas in km^2 of the areas and subareas</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use Lambert equal area projection of areas (Admin-1) and subareas (Admin-2)</span></span></span>
<span class="r-in"><span><span class="va">midLon</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">@</span><span class="va">bbox</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">midLat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">@</span><span class="va">bbox</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p4s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"+proj=laea +x_0=0 +y_0=0 +lon_0="</span>, <span class="va">midLon</span>, </span></span>
<span class="r-in"><span>             <span class="st">" +lat_0="</span>, <span class="va">midLat</span>, <span class="st">" +units=km"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adm1_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">adm1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm1proj_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">adm1_sf</span>, <span class="va">p4s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm1proj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">adm1proj_sf</span>, <span class="st">"Spatial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adm2_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">adm2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2proj_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">adm2_sf</span>, <span class="va">p4s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adm2proj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">adm2proj_sf</span>, <span class="st">"Spatial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now calculate spatial area in km^2</span></span></span>
<span class="r-in"><span><span class="va">admin1Areas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">adm1proj_sf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">admin2Areas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">adm2proj_sf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">areapaKenya</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">adm1proj</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span>, spatialArea<span class="op">=</span><span class="va">admin1Areas</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">areapsubKenya</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">adm2proj</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span>, subarea<span class="op">=</span><span class="va">adm2proj</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span>, </span></span>
<span class="r-in"><span>                           spatialArea<span class="op">=</span><span class="va">admin2Areas</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate general population totals at the subarea (Admin-2) x urban/rural </span></span></span>
<span class="r-in"><span><span class="co"># level and using 1km resolution population grid. Assign urbanicity by </span></span></span>
<span class="r-in"><span><span class="co"># thresholding population density based on estimated proportion population </span></span></span>
<span class="r-in"><span><span class="co"># urban/rural, making sure total area (Admin-1) urban/rural populations in </span></span></span>
<span class="r-in"><span><span class="co"># each area matches poppaKenya.</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dnychka/fieldsRPackage" class="external-link">fields</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: the following function will typically take ~15-20 minutes. Can speed up </span></span></span>
<span class="r-in"><span><span class="co">#       by setting kmRes to be higher, but we recommend fine resolution for </span></span></span>
<span class="r-in"><span><span class="co">#       this step, since it only needs to be done once. Instead of running this, </span></span></span>
<span class="r-in"><span><span class="co">#       you can simply run data(kenyaPopulationData)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">poppsubKenya</span> <span class="op">&lt;-</span> <span class="fu">getPoppsub</span><span class="op">(</span></span></span>
<span class="r-in"><span>  kmRes<span class="op">=</span><span class="fl">1</span>, pop<span class="op">=</span><span class="va">pop</span>, domainMapDat<span class="op">=</span><span class="va">adm0</span>,</span></span>
<span class="r-in"><span>  eastLim<span class="op">=</span><span class="va">eastLim</span>, northLim<span class="op">=</span><span class="va">northLim</span>, mapProjection<span class="op">=</span><span class="va">projKenya</span>,</span></span>
<span class="r-in"><span>  poppa <span class="op">=</span> <span class="va">poppaKenya</span>, areapa<span class="op">=</span><span class="va">areapaKenya</span>, areapsub<span class="op">=</span><span class="va">areapsubKenya</span>, </span></span>
<span class="r-in"><span>  areaMapDat<span class="op">=</span><span class="va">adm1</span>, subareaMapDat<span class="op">=</span><span class="va">adm2</span>, </span></span>
<span class="r-in"><span>  areaNameVar <span class="op">=</span> <span class="st">"NAME_1"</span>, subareaNameVar<span class="op">=</span><span class="st">"NAME_2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now generate a general population integration table at 5km resolution, </span></span></span>
<span class="r-in"><span><span class="co"># based on subarea (Admin-2) x urban/rural population totals. This takes </span></span></span>
<span class="r-in"><span><span class="co"># ~1 minute</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">popMatKenya</span> <span class="op">&lt;-</span> <span class="fu">makePopIntegrationTab</span><span class="op">(</span></span></span>
<span class="r-in"><span>  kmRes<span class="op">=</span><span class="fl">5</span>, pop<span class="op">=</span><span class="va">pop</span>, domainMapDat<span class="op">=</span><span class="va">adm0</span>,</span></span>
<span class="r-in"><span>  eastLim<span class="op">=</span><span class="va">eastLim</span>, northLim<span class="op">=</span><span class="va">northLim</span>, mapProjection<span class="op">=</span><span class="va">projKenya</span>,</span></span>
<span class="r-in"><span>  poppa <span class="op">=</span> <span class="va">poppaKenya</span>, poppsub<span class="op">=</span><span class="va">poppsubKenya</span>, </span></span>
<span class="r-in"><span>  areaMapDat <span class="op">=</span> <span class="va">adm1</span>, subareaMapDat <span class="op">=</span> <span class="va">adm2</span>,</span></span>
<span class="r-in"><span>  areaNameVar <span class="op">=</span> <span class="st">"NAME_1"</span>, subareaNameVar<span class="op">=</span><span class="st">"NAME_2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Adjust popMat to be target (neonatal) rather than general population density. First</span></span></span>
<span class="r-in"><span><span class="co">## creat the target population frame</span></span></span>
<span class="r-in"><span><span class="co">## (these numbers are based on IPUMS microcensus data)</span></span></span>
<span class="r-in"><span><span class="va">mothersPerHouseholdUrb</span> <span class="op">=</span> <span class="fl">0.3497151</span></span></span>
<span class="r-in"><span><span class="va">childrenPerMotherUrb</span> <span class="op">=</span> <span class="fl">1.295917</span></span></span>
<span class="r-in"><span><span class="va">mothersPerHouseholdRur</span> <span class="op">=</span> <span class="fl">0.4787696</span></span></span>
<span class="r-in"><span><span class="va">childrenPerMotherRur</span> <span class="op">=</span> <span class="fl">1.455222</span></span></span>
<span class="r-in"><span><span class="va">targetPopPerStratumUrban</span> <span class="op">=</span> <span class="va">easpaKenya</span><span class="op">$</span><span class="va">HHUrb</span> <span class="op">*</span> <span class="va">mothersPerHouseholdUrb</span> <span class="op">*</span> <span class="va">childrenPerMotherUrb</span></span></span>
<span class="r-in"><span><span class="va">targetPopPerStratumRural</span> <span class="op">=</span> <span class="va">easpaKenya</span><span class="op">$</span><span class="va">HHRur</span> <span class="op">*</span> <span class="va">mothersPerHouseholdRur</span> <span class="op">*</span> <span class="va">childrenPerMotherRur</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span> <span class="op">=</span> <span class="va">easpaKenya</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popUrb</span> <span class="op">=</span> <span class="va">targetPopPerStratumUrban</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popRur</span> <span class="op">=</span> <span class="va">targetPopPerStratumRural</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span> <span class="op">=</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popUrb</span> <span class="op">+</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popRur</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">pctUrb</span> <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popUrb</span> <span class="op">/</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span></span></span>
<span class="r-in"><span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">pctTotal</span> <span class="op">=</span> </span></span>
<span class="r-in"><span>  <span class="fl">100</span> <span class="op">*</span> <span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">easpaKenyaNeonatal</span><span class="op">$</span><span class="va">popTotal</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the target population density by scaling the current population density grid </span></span></span>
<span class="r-in"><span><span class="co"># at the Admin1 x urban/rural level</span></span></span>
<span class="r-in"><span><span class="va">popMatKenyaNeonatal</span> <span class="op">=</span> <span class="fu">adjustPopMat</span><span class="op">(</span><span class="va">popMatKenya</span>, <span class="va">easpaKenyaNeonatal</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate neonatal population table from the neonatal population integration matrix.</span></span></span>
<span class="r-in"><span><span class="co"># This is technically not necessary for population simulation purposes, but is here </span></span></span>
<span class="r-in"><span><span class="co"># for illustrative purposes</span></span></span>
<span class="r-in"><span><span class="va">poppsubKenyaNeonatal</span> <span class="op">=</span> <span class="fu"><a href="poppRegionFromPopMat.html">poppRegionFromPopMat</a></span><span class="op">(</span><span class="va">popMatKenyaNeonatal</span>, <span class="va">popMatKenyaNeonatal</span><span class="op">$</span><span class="va">subarea</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">poppsubKenyaNeonatal</span> <span class="op">=</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>subarea<span class="op">=</span><span class="va">poppsubKenyaNeonatal</span><span class="op">$</span><span class="va">region</span>, </span></span>
<span class="r-in"><span>                             area<span class="op">=</span><span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">poppsubKenyaNeonatal</span><span class="op">$</span><span class="va">region</span>, </span></span>
<span class="r-in"><span>                               <span class="va">adm2</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">NAME_2</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                             <span class="va">poppsubKenyaNeonatal</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">poppsubKenyaNeonatal</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zehang R Li, Bryan D Martin, Yuan Hsiao, Jessica Godwin, John Paige, Peter Gao, Jon Wakefield, Samuel J Clark, Geir-Arne Fuglstad, Andrea Riebler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

