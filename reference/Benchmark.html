<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Benchmark posterior draws to national estimates"><title>Benchmark posterior draws to national estimates — Benchmark • SUMMER</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Benchmark posterior draws to national estimates — Benchmark"><meta property="og:description" content="Benchmark posterior draws to national estimates"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SUMMER</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/web_only/small-area-estimation.html">Generic small area estimation</a>
    <a class="dropdown-item" href="../articles/web_only/u5mr-vignette.html">Estimating Subnational U5MR using Simulated Data</a>
    <a class="dropdown-item" href="../articles/web_only/u5mr-dhs-vignette.html">Estimating Subnational U5MR using DHS Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/richardli/SUMMER/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Benchmark posterior draws to national estimates</h1>
      <small class="dont-index">Source: <a href="https://github.com/richardli/SUMMER/blob/HEAD/R/benchmark.R" class="external-link"><code>R/benchmark.R</code></a></small>
      <div class="d-none name"><code>Benchmark.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Benchmark posterior draws to national estimates</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Benchmark</span><span class="op">(</span></span>
<span>  <span class="va">fitted</span>,</span>
<span>  <span class="va">national</span>,</span>
<span>  <span class="va">estVar</span>,</span>
<span>  <span class="va">sdVar</span>,</span>
<span>  timeVar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weight.region <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MH"</span>, <span class="st">"Rejection"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fitted</dt>
<dd><p>output from <code><a href="getSmoothed.html">getSmoothed</a></code> to be benchmarked.</p></dd>


<dt>national</dt>
<dd><p>a data frame of national level estimates that is benchmarked against, with at least two columns indicating national estimates (probability scale) and the associated standard error. If benchmarking over multiple time period, a third column indicating time period is needed.</p></dd>


<dt>estVar</dt>
<dd><p>column name in <code>national</code> that indicates national estimates.</p></dd>


<dt>sdVar</dt>
<dd><p>column name in <code>national</code> that indicates standard errors of national estimates.</p></dd>


<dt>timeVar</dt>
<dd><p>column name in <code>national</code> that indicates time periods.</p></dd>


<dt>weight.region</dt>
<dd><p>a data frame with a column `region` specifying subnational regions, a column `proportion` that specifies the proportion of population in each region. When multiple time periods exist, a third column `years` is required and the population proportions are the population proportions of each region in the corresponding time period.</p></dd>


<dt>method</dt>
<dd><p>a string denoting the algorithm to use for benchmarking. Options include `MH` for Metropolis-Hastings, and `Rejection` for rejection sampler. Defaults to `Rejection`.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Benchmarked object in S3 class SUMMERproj or SUMMERprojlist in the same format as the input object <code>fitted</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Taylor Okonek, Zehang Richard Li</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">##  ------------------------------------------ ##</span></span></span>
<span class="r-in"><span><span class="co">##     Benchmarking with smoothCluster output</span></span></span>
<span class="r-in"><span><span class="co">##  ------------------------------------------ ##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># fit unstratified cluster-level model</span></span></span>
<span class="r-in"><span><span class="va">counts.all</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clustid"</span>, <span class="st">"region"</span>, <span class="st">"time"</span>, <span class="st">"age"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="getCounts.html">getCounts</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span>, <span class="st">"died"</span><span class="op">)</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>            variables <span class="op">=</span> <span class="st">'died'</span>,</span></span>
<span class="r-in"><span>             by <span class="op">=</span> <span class="va">vars</span>, drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">counts</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">clustid</span></span></span>
<span class="r-in"><span><span class="va">counts</span><span class="op">$</span><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">time</span></span></span>
<span class="r-in"><span><span class="va">counts</span><span class="op">$</span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">died</span></span></span>
<span class="r-in"><span><span class="va">counts</span><span class="op">$</span><span class="va">survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>  </span></span>
<span class="r-in"><span><span class="va">counts.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">counts.all</span>, <span class="va">counts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"85-89"</span>, <span class="st">"90-94"</span>, <span class="st">"95-99"</span>, <span class="st">"00-04"</span>, <span class="st">"05-09"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit.bb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="smoothCluster.html">smoothCluster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">counts.all</span>, Amat <span class="op">=</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">Amat</span>, </span></span>
<span class="r-in"><span>        family <span class="op">=</span> <span class="st">"betabinomial"</span>,</span></span>
<span class="r-in"><span>        year_label <span class="op">=</span> <span class="va">periods</span>, </span></span>
<span class="r-in"><span>        survey.effect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est.bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit.bb</span>, nsim <span class="op">=</span> <span class="fl">1e4</span>, CI <span class="op">=</span> <span class="fl">0.95</span>, save.draws<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct a simple population weight data frame with equal weights</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">counts.all</span><span class="op">$</span><span class="va">region</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>             years <span class="op">=</span> <span class="va">periods</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct a simple national estimates</span></span></span>
<span class="r-in"><span><span class="va">national</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>years <span class="op">=</span> <span class="va">periods</span>, </span></span>
<span class="r-in"><span>           est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.27</span>, <span class="fl">0.1</span>, length <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>           sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># benchmarking</span></span></span>
<span class="r-in"><span><span class="va">est.bb.bench</span> <span class="op">&lt;-</span> <span class="fu">Benchmark</span><span class="op">(</span><span class="va">est.bb</span>, <span class="va">national</span>, weight.region <span class="op">=</span> <span class="va">weight.region</span>, </span></span>
<span class="r-in"><span>            estVar <span class="op">=</span> <span class="st">"est"</span>, sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sanity check: Benchmarking comparison</span></span></span>
<span class="r-in"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="va">national</span></span></span>
<span class="r-in"><span><span class="va">compare</span><span class="op">$</span><span class="va">before</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">compare</span><span class="op">$</span><span class="va">after</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">compare</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">weight.region</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub</span>, <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb.bench</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub.bench</span>, <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub.bench</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub.bench</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, </span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Weighted posterior median after benchmarking"</span>,</span></span>
<span class="r-in"><span>    main <span class="op">=</span> <span class="st">"Sanity check: weighted average of area medians"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#  construct a simple national estimates</span></span></span>
<span class="r-in"><span><span class="va">national</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>years <span class="op">=</span> <span class="va">periods</span>, </span></span>
<span class="r-in"><span>             est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.22</span>, <span class="fl">0.1</span>, length <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>             sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># national does not need to have all years</span></span></span>
<span class="r-in"><span><span class="va">national_sub</span> <span class="op">&lt;-</span> <span class="va">national</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># benchmarking</span></span></span>
<span class="r-in"><span><span class="va">est.bb.bench</span> <span class="op">&lt;-</span> <span class="fu">Benchmark</span><span class="op">(</span><span class="va">est.bb</span>, <span class="va">national_sub</span>, </span></span>
<span class="r-in"><span>            weight.region <span class="op">=</span> <span class="va">weight.region</span>, </span></span>
<span class="r-in"><span>            estVar <span class="op">=</span> <span class="st">"est"</span>, sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sanity check: only benchmarked for three periods</span></span></span>
<span class="r-in"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="va">national</span></span></span>
<span class="r-in"><span><span class="va">compare</span><span class="op">$</span><span class="va">before</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">compare</span><span class="op">$</span><span class="va">after</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">compare</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">weight.region</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub</span>, <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb.bench</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub.bench</span>, <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub.bench</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub.bench</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, </span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Weighted posterior median after benchmarking"</span>,</span></span>
<span class="r-in"><span>    main <span class="op">=</span> <span class="st">"Sanity check: weighted average of area medians"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#  Another extreme benchmarking example, where almost all weights in central region</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span><span class="op">[</span><span class="va">weight.region</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="st">"central"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.97</span></span></span>
<span class="r-in"><span><span class="co"># benchmarking</span></span></span>
<span class="r-in"><span><span class="va">est.bb.bench</span> <span class="op">&lt;-</span> <span class="fu">Benchmark</span><span class="op">(</span><span class="va">est.bb</span>, <span class="va">national</span>, weight.region <span class="op">=</span> <span class="va">weight.region</span>, </span></span>
<span class="r-in"><span>          estVar <span class="op">=</span> <span class="st">"est"</span>, sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># It can be seen the central region are pulled to the national benchmark</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb.bench</span><span class="op">$</span><span class="va">overall</span>, <span class="va">region</span> <span class="op">==</span> <span class="st">"central"</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span>,</span></span>
<span class="r-in"><span>   col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span>, xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, </span></span>
<span class="r-in"><span>   ylab <span class="op">=</span> <span class="st">"Central region estimates"</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span>, <span class="va">region</span> <span class="op">==</span> <span class="st">"central"</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example with the MH method</span></span></span>
<span class="r-in"><span><span class="co"># Benchmarking with MH should be applied when customized priors are </span></span></span>
<span class="r-in"><span><span class="co">#  specified for fixed effects when fitting the model</span></span></span>
<span class="r-in"><span><span class="va">fit.bb.new</span>  <span class="op">&lt;-</span> <span class="fu"><a href="smoothCluster.html">smoothCluster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">counts.all</span>, Amat <span class="op">=</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">Amat</span>, </span></span>
<span class="r-in"><span>        family <span class="op">=</span> <span class="st">"betabinomial"</span>,</span></span>
<span class="r-in"><span>        year_label <span class="op">=</span> <span class="va">periods</span>, </span></span>
<span class="r-in"><span>        survey.effect <span class="op">=</span> <span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>        control.fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>          mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`age.intercept0:1`<span class="op">=</span><span class="op">-</span><span class="fl">4</span>, </span></span>
<span class="r-in"><span>                   `age.intercept1-11:1`<span class="op">=</span><span class="op">-</span><span class="fl">5</span>,</span></span>
<span class="r-in"><span>                   `age.intercept12-23:1`<span class="op">=</span><span class="op">-</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>                   `age.intercept24-35:1`<span class="op">=</span><span class="op">-</span><span class="fl">9</span>,</span></span>
<span class="r-in"><span>                   `age.intercept36-47:1`<span class="op">=</span><span class="op">-</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                   `age.intercept48-59:1`<span class="op">=</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>          prec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`age.intercept0:1`<span class="op">=</span><span class="fl">10</span>, </span></span>
<span class="r-in"><span>                   `age.intercept1-11:1`<span class="op">=</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                   `age.intercept12-23:1`<span class="op">=</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                   `age.intercept24-35:1`<span class="op">=</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                   `age.intercept36-47:1`<span class="op">=</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                   `age.intercept48-59:1`<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est.bb.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit.bb.new</span>, nsim <span class="op">=</span> <span class="fl">10000</span>, CI <span class="op">=</span> <span class="fl">0.95</span>, save.draws<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#  construct a simple national estimates</span></span></span>
<span class="r-in"><span><span class="va">national</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>years <span class="op">=</span> <span class="va">periods</span>, </span></span>
<span class="r-in"><span>             est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.22</span>, <span class="fl">0.1</span>, length <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>             sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">counts.all</span><span class="op">$</span><span class="va">region</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>             years <span class="op">=</span> <span class="va">periods</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="fl">0.25</span>             </span></span>
<span class="r-in"><span><span class="va">est.bb.bench.MH</span> <span class="op">&lt;-</span> <span class="fu">Benchmark</span><span class="op">(</span><span class="va">est.bb.new</span>, <span class="va">national</span>, </span></span>
<span class="r-in"><span>  weight.region <span class="op">=</span> <span class="va">weight.region</span>, </span></span>
<span class="r-in"><span>  estVar <span class="op">=</span> <span class="st">"est"</span>, sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"MH"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="va">national</span></span></span>
<span class="r-in"><span><span class="va">compare</span><span class="op">$</span><span class="va">before</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">compare</span><span class="op">$</span><span class="va">after</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">compare</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">weight.region</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb.new</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub</span>, <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb.bench.MH</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub.bench</span>, <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub.bench</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub.bench</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, </span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Weighted posterior median after benchmarking"</span>,</span></span>
<span class="r-in"><span>    main <span class="op">=</span> <span class="st">"Sanity check: weighted average of area medians"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  ------------------------------------------ ##</span></span></span>
<span class="r-in"><span><span class="co">##     Benchmarking with smoothDirect output</span></span></span>
<span class="r-in"><span><span class="co">##  ------------------------------------------ ##</span></span></span>
<span class="r-in"><span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># obtain direct estimates</span></span></span>
<span class="r-in"><span><span class="va">data_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="getDirectList.html">getDirectList</a></span><span class="op">(</span>births <span class="op">=</span> <span class="va">DemoData</span>, years <span class="op">=</span> <span class="va">years</span>,</span></span>
<span class="r-in"><span>                        regionVar <span class="op">=</span> <span class="st">"region"</span>,  timeVar <span class="op">=</span> <span class="st">"time"</span>, clusterVar <span class="op">=</span> <span class="st">"~clustid+id"</span>,</span></span>
<span class="r-in"><span>                        ageVar <span class="op">=</span> <span class="st">"age"</span>, weightsVar <span class="op">=</span> <span class="st">"weights"</span>, geo.recode <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregateSurvey.html">aggregateSurvey</a></span><span class="op">(</span><span class="va">data_multi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#  subnational model</span></span></span>
<span class="r-in"><span><span class="va">years.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">years</span>, <span class="st">"15-19"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="smoothDirect.html">smoothDirect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, Amat <span class="op">=</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">Amat</span>,</span></span>
<span class="r-in"><span>                 year_label <span class="op">=</span> <span class="va">years.all</span>, year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span>, <span class="fl">2019</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 time.model <span class="op">=</span> <span class="st">"rw2"</span>, m <span class="op">=</span> <span class="fl">5</span>, type.st <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit2</span>, joint <span class="op">=</span> <span class="cn">TRUE</span>, nsim <span class="op">=</span> <span class="fl">1e5</span>, save.draws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## Benchmarking for yearly estimates</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">region</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">region</span> <span class="op">!=</span> <span class="st">"All"</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             years <span class="op">=</span> <span class="fl">1985</span><span class="op">:</span><span class="fl">2019</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span><span class="co"># construct a simple national estimates</span></span></span>
<span class="r-in"><span><span class="va">national</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fl">1985</span><span class="op">:</span><span class="fl">2019</span>,</span></span>
<span class="r-in"><span>                       est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.15</span>, length <span class="op">=</span> <span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">0.03</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Benchmarking to national estimates on the yearly scale</span></span></span>
<span class="r-in"><span><span class="va">out2b</span> <span class="op">&lt;-</span> <span class="fu">Benchmark</span><span class="op">(</span><span class="va">out2a</span>, <span class="va">national</span>, weight.region <span class="op">=</span> <span class="va">weight.region</span>,</span></span>
<span class="r-in"><span>                          estVar <span class="op">=</span> <span class="st">"est"</span>, sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out2a</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span>  </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out2b</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine the point estimate and compare with the benchmark values</span></span></span>
<span class="r-in"><span><span class="va">national.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">~</span> <span class="va">years</span>, </span></span>
<span class="r-in"><span>   data <span class="op">=</span> <span class="va">out2a</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="va">out2a</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">is.yearly</span>, <span class="op">]</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">national.est.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">~</span> <span class="va">years</span>, </span></span>
<span class="r-in"><span>   data <span class="op">=</span> <span class="va">out2b</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="va">out2b</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">is.yearly</span>, <span class="op">]</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est</span><span class="op">$</span><span class="va">mean</span>,  </span></span>
<span class="r-in"><span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est</span><span class="op">$</span><span class="va">mean</span>, <span class="va">national.est.bench</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est</span><span class="op">$</span><span class="va">mean</span>, <span class="va">national.est.bench</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, </span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Weighted posterior median after benchmarking"</span>,</span></span>
<span class="r-in"><span>    main <span class="op">=</span> <span class="st">"Sanity check: weighted average of area means"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est.bench</span><span class="op">$</span><span class="va">mean</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## Benchmarking for period estimates</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">region</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">region</span> <span class="op">!=</span> <span class="st">"All"</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             years <span class="op">=</span> <span class="va">years.all</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span><span class="co"># construct a simple national estimates</span></span></span>
<span class="r-in"><span><span class="va">national</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>years <span class="op">=</span> <span class="va">years.all</span>,</span></span>
<span class="r-in"><span>                       est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.15</span>, len <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Benchmarking to national estimates on the period scale</span></span></span>
<span class="r-in"><span><span class="va">out2c</span> <span class="op">&lt;-</span> <span class="fu">Benchmark</span><span class="op">(</span><span class="va">out2a</span>, <span class="va">national</span>, weight.region <span class="op">=</span> <span class="va">weight.region</span>,</span></span>
<span class="r-in"><span>                          estVar <span class="op">=</span> <span class="st">"est"</span>, sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out2a</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out2c</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine the point estimate and compare with the benchmark values</span></span></span>
<span class="r-in"><span><span class="va">national.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">~</span> <span class="va">years</span>, </span></span>
<span class="r-in"><span>      data <span class="op">=</span> <span class="va">out2a</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="op">!</span><span class="va">out2a</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">is.yearly</span>, <span class="op">]</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">national.est.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">mean</span> <span class="op">~</span> <span class="va">years</span>, </span></span>
<span class="r-in"><span>      data <span class="op">=</span> <span class="va">out2c</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="op">!</span><span class="va">out2b</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">is.yearly</span>, <span class="op">]</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est</span><span class="op">$</span><span class="va">mean</span>,  </span></span>
<span class="r-in"><span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est</span><span class="op">$</span><span class="va">mean</span>, <span class="va">national.est.bench</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est</span><span class="op">$</span><span class="va">mean</span>, <span class="va">national.est.bench</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, </span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Weighted posterior median after benchmarking"</span>,</span></span>
<span class="r-in"><span>    main <span class="op">=</span> <span class="st">"Sanity check: weighted average of area means"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">national</span><span class="op">$</span><span class="va">est</span>, <span class="va">national.est.bench</span><span class="op">$</span><span class="va">mean</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zehang R Li, Bryan D Martin, Yuan Hsiao, Jessica Godwin, John Paige, Peter Gao, Jon Wakefield, Samuel J Clark, Geir-Arne Fuglstad, Andrea Riebler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

