<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SUMMER">
<title>Generic small area estimation • SUMMER</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Generic small area estimation">
<meta property="og:description" content="SUMMER">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">SUMMER</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/web_only/small-area-estimation.html">Generic small area estimation</a>
    <a class="dropdown-item" href="../../articles/web_only/u5mr-vignette.html">Estimating Subnational U5MR using Simulated Data</a>
    <a class="dropdown-item" href="../../articles/web_only/u5mr-dhs-vignette.html">Estimating Subnational U5MR using DHS Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/richardli/SUMMER/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Generic small area estimation</h1>
                        <h4 data-toc-skip class="author">Peter Gao and
Jon Wakefield</h4>
            
            <h4 data-toc-skip class="date">2024-02-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/richardli/SUMMER/blob/HEAD/vignettes/articles/web_only/small-area-estimation.Rmd" class="external-link"><code>vignettes/articles/web_only/small-area-estimation.Rmd</code></a></small>
      <div class="d-none name"><code>small-area-estimation.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we illustrate the use of the
<code>smoothArea</code> and <code>smoothUnit</code> functions for
generic small area estimation of outcomes other than under-five
mortality rates. Using example data presented in the <code>sae</code>
vignette, we compare our results from <code>SUMMER</code> with those
obtained using the <code>sae</code> package (for a survey of other
packages for small area estimation, see <span class="citation">Kreutzmann et al. (2019)</span>).</p>
<div class="section level2">
<h2 id="preliminary">Preliminary<a class="anchor" aria-label="anchor" href="#preliminary"></a>
</h2>
<p>First, we load the necessary packages and data. The required package
<code>INLA</code> is not available via a standard repository, so we
include code for installation if it is not found. The
<code>survey</code> package will be used to generate direct estimates,
while <code>dplyr</code> and <code>tidyr</code> will be used for data
manipulation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sae</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/richardli/SUMMER" class="external-link">SUMMER</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"INLA"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"INLA"</span>, repos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span>, </span>
<span>                  INLA<span class="op">=</span><span class="st">"https://inla.r-inla-download.org/R/stable"</span><span class="op">)</span>, dep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="area-level-models">Area level models<a class="anchor" aria-label="anchor" href="#area-level-models"></a>
</h2>
<div class="section level3">
<h3 id="artificial-poverty-rate-example">Artificial poverty rate example<a class="anchor" aria-label="anchor" href="#artificial-poverty-rate-example"></a>
</h3>
<p>In their vignette for the <code>sae</code> package, <span class="citation">Molina and Marhuenda (2015)</span> generate an
artificial dataset on income and other related variables to illustrate
the use of area level models. In this example, the objective is to
estimate prevalence of poverty in Spanish counties.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"incomedata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sizeprov"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sizeprovedu"</span><span class="op">)</span></span>
<span><span class="va">povertyline</span> <span class="op">&lt;-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">incomedata</span><span class="op">$</span><span class="va">income</span><span class="op">)</span> <span class="co"># 6557.143</span></span>
<span><span class="va">incomedata</span><span class="op">$</span><span class="va">in_poverty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">incomedata</span><span class="op">$</span><span class="va">income</span> <span class="op">&lt;</span> <span class="va">povertyline</span><span class="op">)</span></span></code></pre></div>
<p>The <code>incomedata</code> data frame contains information on 17199
observations of individuals in 52 Spanish provinces. Income values and
sampling weights are provided for each individual along with covariate
information including age group and education level. <span class="citation">Molina and Marhuenda (2015)</span> define the poverty
line and calculate an indicator variable (which we name
<code>in_poverty</code>) with value 1 if the corresponding income value
is below the poverty line and 0 otherwise.</p>
<div class="section level4">
<h4 id="direct-estimation-with-sae">Direct estimation with <code>sae</code><a class="anchor" aria-label="anchor" href="#direct-estimation-with-sae"></a>
</h4>
<p>Before considering model-based methods for small area estimation, we
compute direct weighted estimators for the desired small area means. The
<code><a href="https://rdrr.io/pkg/sae/man/direct.html" class="external-link">sae::direct</a></code> function computes the Horvitz-Thompson
estimator of domain means given by</p>
<p><span class="math display">\[
\widehat{\overline{Y}}_{i}^{\text{DIR}}=\frac{1}{N_i}\sum_{j\in
S_i}w_{j}y_{j}
\]</span></p>
<p>where <span class="math inline">\(N_i\)</span> is the population size
of domain <span class="math inline">\(i\)</span>, <span class="math inline">\(S_i\)</span> is the set of sampled observations in
domain <span class="math inline">\(i\)</span>, <span class="math inline">\(w_{j}\)</span> is the sampling weight for unit
<span class="math inline">\(j\)</span>, and <span class="math inline">\(y_{j}\)</span> is the observation for unit <span class="math inline">\(j\)</span>, for all <span class="math inline">\(j
\in S_i\)</span>. The <code><a href="https://rdrr.io/pkg/sae/man/direct.html" class="external-link">sae::direct</a></code> function also estimates
standard deviation and coefficient of variation for each domain. Note
that <span class="math inline">\(N_i\)</span> is assumed known and is
provided in the data frame <code>sizeprov</code>. The domains of
interest are identified via the <code>provlab</code> variable.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Popn</span> <span class="op">&lt;-</span> <span class="va">sizeprov</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"provlab"</span>, <span class="st">"Nd"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sae.DIR</span> <span class="op">&lt;-</span> <span class="fu">sae</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sae/man/direct.html" class="external-link">direct</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">incomedata</span><span class="op">$</span><span class="va">in_poverty</span>, dom <span class="op">=</span> <span class="va">incomedata</span><span class="op">$</span><span class="va">provlab</span>,</span>
<span>                       sweight <span class="op">=</span> <span class="va">incomedata</span><span class="op">$</span><span class="va">weight</span>, domsize <span class="op">=</span> <span class="va">Popn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Domain</span>, <span class="va">Direct</span>, <span class="va">SD</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="direct-estimation-with-survey">Direct estimation with <code>survey</code><a class="anchor" aria-label="anchor" href="#direct-estimation-with-survey"></a>
</h4>
<p>We can similarly use the <code><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">survey::svyby</a></code> function to
compute the Horvitz-Thompson estimates:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incomedata</span><span class="op">$</span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sizeprov</span><span class="op">$</span><span class="va">Nd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">incomedata</span><span class="op">$</span><span class="va">provlab</span>, <span class="va">sizeprov</span><span class="op">$</span><span class="va">provlab</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">weight</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">incomedata</span>, fpc <span class="op">=</span> <span class="op">~</span><span class="va">pop</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate area totals</span></span>
<span><span class="va">svy.DIR</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span><span class="op">~</span><span class="va">in_poverty</span>, <span class="op">~</span><span class="va">provlab</span>, <span class="va">design</span>, <span class="va">svytotal</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate corresponding area mean estimates</span></span>
<span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">prov_pop</span> <span class="op">&lt;-</span> <span class="va">sizeprov</span><span class="op">$</span><span class="va">Nd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">provlab</span>, <span class="va">sizeprov</span><span class="op">$</span><span class="va">provlab</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">Domain</span> <span class="op">&lt;-</span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">provlab</span> </span>
<span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">Direct</span> <span class="op">=</span> <span class="va">svy.DIR</span><span class="op">$</span><span class="va">in_poverty</span><span class="op">/</span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">prov_pop</span></span>
<span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">=</span> <span class="va">svy.DIR</span><span class="op">$</span><span class="va">se</span><span class="op">/</span><span class="va">svy.DIR</span><span class="op">$</span><span class="va">prov_pop</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="basic-area-level-model">Basic area level model<a class="anchor" aria-label="anchor" href="#basic-area-level-model"></a>
</h4>
<p>The basic area level model, also called the Fay-Herriot model, treats
direct estimates of small area quantities as response data and
explicitly models differences between areas using covariate information
and random effects <span class="citation">Fay and Herriot (1979)</span>.
The Fay-Herriot model can be viewed as a two-stage model: in the first
stage, a <em>sampling model</em> represents the sampling variability of
a direct estimator and in the second stage, a <em>linking model</em>
describes the between area differences in small area quantities.</p>
<p><strong>Sampling model</strong>:</p>
<p>Let <span class="math inline">\(\widehat\theta^{\text{DIR}}_i\)</span> be a direct
estimator of an area level mean or total <span class="math inline">\(\theta_i\)</span>. The sampling model treats <span class="math inline">\(\widehat\theta^{\text{DIR}}_i\)</span> as a noisy
observation of the true finite population quantity <span class="math inline">\(\theta_i\)</span>:</p>
<p><span class="math display">\[
\widehat\theta^{\text{DIR}}_i=\theta_i+\epsilon_i;\hspace{2em}\epsilon_i\sim_{ind}N(0,V_i),\hspace{2em}i=1,\ldots,
M
\]</span></p>
<p>where <span class="math inline">\(V_i\)</span> is the <strong>known
sampling variance</strong> of the direct estimator <span class="math inline">\(\widehat{\theta}^{\text{DIR}}_i\)</span>.</p>
<p><strong>Linking model</strong>:</p>
<p><span class="math display">\[
\theta_i =
\textbf{x}_i^T\boldsymbol\beta+u_i,\hspace{2em}u_i\sim_{ind}N(0,\sigma_u^2)\hspace{2em}i=1,\ldots,
M,
\]</span></p>
<p>where <span class="math inline">\(\sigma_u^2\)</span> (between-area
residual variance) is estimated. In this basic Fay-Herriot model, the
area-specific random effects <span class="math inline">\(u_i\)</span>
are assumed to be independent and identically distributed (IID) between
areas.</p>
<p>Below, we provide a quantile-quantile plot comparing the direct
estimates to a Gaussian distribution. Here the observed quantiles align
well with those from a Gaussian distribution, which lends some support
to the basic IID model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>pty <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="va">mu.DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span><span class="op">)</span></span>
<span><span class="va">sd.DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span> <span class="op">-</span> <span class="va">mu.DIR</span><span class="op">)</span> <span class="op">/</span> <span class="va">sd.DIR</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-1-1.png" width="50%"></p>
</div>
<div class="section level4">
<h4 id="area-level-modeling-with-sae">Area level modeling with <code>sae</code><a class="anchor" aria-label="anchor" href="#area-level-modeling-with-sae"></a>
</h4>
<p>As described by <span class="citation">Molina and Marhuenda
(2015)</span>, the <code><a href="https://rdrr.io/pkg/sae/man/mseFH.html" class="external-link">sae::mseFH</a></code> function fits the basic area
level model (via REML by default) and calculates the empirical best
linear unbiased predictors (EBLUP) for all domain means as well as their
estimated MSEs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sae.FH</span> <span class="op">&lt;-</span> <span class="fu">sae</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sae/man/mseFH.html" class="external-link">mseFH</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span><span class="op">~</span><span class="fl">1</span>, <span class="va">sae.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sae.FH.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Domain <span class="op">=</span> <span class="va">sae.DIR</span><span class="op">$</span><span class="va">Domain</span>,</span>
<span>  EBLUP <span class="op">=</span> <span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span>,</span>
<span>  RMSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sae.FH.table</span><span class="op">)</span></span>
<span><span class="co">##     Domain      EBLUP       RMSE</span></span>
<span><span class="co">## 1    Alava 0.23407448 0.03836098</span></span>
<span><span class="co">## 2 Albacete 0.15335213 0.02744856</span></span>
<span><span class="co">## 3 Alicante 0.20511853 0.02051886</span></span>
<span><span class="co">## 4  Almeria 0.24498009 0.03427432</span></span>
<span><span class="co">## 5    Avila 0.07797403 0.02372809</span></span>
<span><span class="co">## 6  Badajoz 0.20928033 0.02186672</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="area-level-modeling-with-summer">Area level modeling with <code>SUMMER</code><a class="anchor" aria-label="anchor" href="#area-level-modeling-with-summer"></a>
</h4>
<p>The <code>SUMMER</code> package adopts a Bayesian approach to
inference using models such as the basic area level model, carrying out
computation via the <code>INLA</code> package. The
<code>smoothArea</code> function computes direct estimates and then
produces smoothed estimates using a Bayesian Fay-Herriot model. The main
arguments of interest are:</p>
<ul>
<li>
<code>formula</code>: Describing the response variable and any
area-level covariates</li>
<li>
<code>domain</code> A one-sided formula with the variable containing
domain labels on the right. The domain labels variable should be
contained in the dataset used to generate the design.</li>
<li>
<code>design</code>: A <code>survey.design</code> object containing
survey data and specifying the survey design.</li>
</ul>
<p>In addition, other commonly used optional arguments include:</p>
<ul>
<li>
<code>adj.mat</code>: Optional adjacency matrix if a spatial
smoothing model is desired.</li>
<li>
<code>transform</code>: If <code>"logit"</code> is specified, a
logit transform will be applied to the direct estimates and an
appropriate transformation will be applied to the estimated sampling
variances before smoothing.</li>
<li>
<code>direct.est</code>: The direct estimates may be specified
directly and smoothing will be applied directly to these user-provided
estimates.</li>
<li>
<code>X.domain</code>: Data frame of area level covariates.</li>
<li>
<code>domain.size</code>: Data frame of domain sizes used for
computing direct estimates if domain sizes are known.</li>
</ul>
<p>Other optional arguments can be specified to change the priors and
are described further in the documentation.</p>
<p>For the artificial poverty rate example, we fit the Fay-Herriot model
and obtain the following smoothed estimates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify known domain sizes</span></span>
<span><span class="va">domain.size</span> <span class="op">&lt;-</span> <span class="va">sizeprov</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"provlab"</span>, <span class="st">"Nd"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">domain.size</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"size"</span></span>
<span></span>
<span><span class="co"># fit model and obtain svysae object</span></span>
<span><span class="va">summer.FH</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothArea.html">smoothArea</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">in_poverty</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>                        domain <span class="op">=</span> <span class="op">~</span><span class="va">provlab</span>,</span>
<span>                        design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                        domain.size <span class="op">=</span> <span class="va">domain.size</span>, </span>
<span>                        return.samples <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">## Warning in smoothArea(formula = in_poverty ~ 1, domain = ~provlab, design =</span></span>
<span><span class="co">## design, : Direct estimates appear to be proportions. You may want to consider</span></span>
<span><span class="co">## using transform = 'logit'.</span></span>
<span></span>
<span><span class="va">summer.FH.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Domain <span class="op">=</span> <span class="va">sae.DIR</span><span class="op">$</span><span class="va">Domain</span>,</span>
<span>  Median <span class="op">=</span> <span class="va">summer.FH</span><span class="op">$</span><span class="va">iid.model.est</span><span class="op">$</span><span class="va">median</span>,</span>
<span>  SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">summer.FH</span><span class="op">$</span><span class="va">iid.model.est</span><span class="op">$</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summer.FH.table</span><span class="op">)</span></span>
<span><span class="co">##     Domain     Median         SE</span></span>
<span><span class="co">## 1    Alava 0.23449184 0.03704801</span></span>
<span><span class="co">## 2 Albacete 0.15383656 0.02760217</span></span>
<span><span class="co">## 3 Alicante 0.20385758 0.02104621</span></span>
<span><span class="co">## 4  Almeria 0.24485689 0.03331238</span></span>
<span><span class="co">## 5    Avila 0.07516739 0.02379961</span></span>
<span><span class="co">## 6  Badajoz 0.20959769 0.02128758</span></span></code></pre></div>
<p>The fitted parameters from <code>sae</code> (obtained via
likelihood-based methods) and estimated parameter posterior distribution
from <code>SUMMER</code> (obtained from Bayesian methods, implemented
via <code>INLA</code>) are in reasonable agreement. The estimated
intercept <span class="math inline">\(\beta_0\)</span> from
<code>sae</code> is 0.202 ; the posterior median of <span class="math inline">\(\beta_0\)</span> from <code>SUMMER</code> is
0.202. In the absence of strong priors, fixed effects are usually in
close agreement, with the posterior being symmetric. The estimated
precision <span class="math inline">\(1/\sigma_u^2\)</span> from
<code>sae</code> is 281.34787 , while the posterior median of <span class="math inline">\(1/\sigma_u^2\)</span> from <code>SUMMER</code> is
273.241562. The differences are larger here, but the posterior for the
variance is skewed, and we would expect the posterior median to be
smaller than the REML estimate. The area estimates and measures of
uncertainty are in close agreement, however.</p>
<p>We first illustrate the shrinkage of the EBLUP estimates, and the
reduced uncertainty:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Direct estimates"</span>,ylab <span class="op">=</span> <span class="st">"sae package"</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">Direct</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Small area estimates"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">^</span><span class="fl">2</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Direct estimates"</span>,ylab <span class="op">=</span> <span class="st">"sae package"</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">^</span><span class="fl">2</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">^</span><span class="fl">2</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">^</span><span class="fl">2</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sae.DIR</span><span class="op">$</span><span class="va">SD</span><span class="op">^</span><span class="fl">2</span>, <span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Estimates of uncertainty"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-2-1.png" width="100%"></p>
<p>Now compare EBLUP and HB, using posterior variance from
<code>SUMMER</code> and estimated MSE from <code>sae</code> to measure
uncertainty:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sae.FH</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span>, <span class="va">summer.FH</span><span class="op">$</span><span class="va">iid.model.est</span><span class="op">$</span><span class="va">median</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"sae package"</span>,ylab <span class="op">=</span> <span class="st">"SUMMER package"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Small area estimates"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sae.FH</span><span class="op">$</span><span class="va">mse</span>,</span>
<span>     <span class="va">summer.FH</span><span class="op">$</span><span class="va">iid.model.est</span><span class="op">$</span><span class="va">var</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"sae package mse"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"SUMMER package model variance"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Estimates of mse/variance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-3-1.png" width="100%"></p>
<p>The <code>SUMMER</code> package includes functions to generate
additional diagnostic plots based on samples from the model posterior.
The <code><a href="../../reference/compareEstimates.html">compareEstimates()</a></code> function generates a heatmap of the
posterior pairwise probabilities of one area’s mean exceeding another’s
mean.</p>
<p>When geographic polygon data for each domain is available as a
shapefile, the <code>sf</code> package can be used to load this data in
R. The <code><a href="../../reference/mapEstimates.html">mapEstimates()</a></code> function can then be used to provide
a summary map of posterior medians or posterior variances.</p>
</div>
</div>
<div class="section level3">
<h3 id="spatial-fay-herriot">Spatial Fay-Herriot<a class="anchor" aria-label="anchor" href="#spatial-fay-herriot"></a>
</h3>
<p>The <code>sae</code> package also provides tools for implementing a
spatial version of the Fay-Herriot model which assumes that the vector
of area specific effects follows a first order simultaneous
autoregressive, or SAR(1), process: <span class="math display">\[\textbf{u}=\rho_1\textbf{Wu}+\boldsymbol\epsilon,\hspace{1em}\boldsymbol\epsilon\sim
N(\textbf{0}_i,\sigma_I^2\textbf{I}_i),\]</span> where <span class="math inline">\(\textbf{I}_i\)</span> is the identity matrix for
the <span class="math inline">\(D\)</span> areas and <span class="math inline">\(\textbf{0}_i\)</span> is a vector of zeroes of
size <span class="math inline">\(D\)</span>. Additionally, <span class="math inline">\(\rho_1\in(-1,1)\)</span> is an autoregression
parameter and <span class="math inline">\(\textbf{W}\)</span> is an
adjacency matrix (with rows standardized to sum to 1).</p>
<p>The <code><a href="https://rdrr.io/pkg/sae/man/mseSFH.html" class="external-link">sae::mseSFH</a></code> function estimates the unknown variance
parameters, the resulting EBLUP small area estimators, and then uses
bootstrap methods to estimate the MSE of the estimators.</p>
<p>To illustrate the use of this function, <span class="citation">Molina
and Marhuenda (2015)</span> consider a synthetic dataset concerning
grape production surface area for 274 Italian municipalities. Below we
load the relevant objects from the <code>sae</code> package. The
<code>grapes</code> dataset containes direct estimators of the mean
surface area in hectares for grape production in each municipality
(<code>grapehect</code>), the sampling variance of these direct
estimators (<code>var</code>), and relevant covariates including number
of working dats and overall agrarian surface area. The
<code>grapesprox</code> object contains the relevant adjacency matrix
representing the municipalities’ neighborhood structure.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"grapes"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"grapesprox"</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="results-using-sae">Results using <code>sae</code><a class="anchor" aria-label="anchor" href="#results-using-sae"></a>
</h5>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sae.FH.grapes</span> <span class="op">&lt;-</span> <span class="fu">sae</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sae/man/mseSFH.html" class="external-link">mseSFH</a></span><span class="op">(</span><span class="va">grapehect</span> <span class="op">~</span> <span class="va">area</span> <span class="op">+</span> <span class="va">workdays</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">var</span>, <span class="va">grapesprox</span>, data <span class="op">=</span> <span class="va">grapes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>DIR <span class="op">=</span> <span class="va">grapes</span><span class="op">$</span><span class="va">grapehect</span>,</span>
<span>                      eblup.SFH <span class="op">=</span> <span class="va">sae.FH.grapes</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span>,</span>
<span>                      mse <span class="op">=</span> <span class="va">sae.FH.grapes</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span></span>
<span><span class="co"># reorder results for comparison later</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">area_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'area_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="results-using-summer">Results using <code>SUMMER</code><a class="anchor" aria-label="anchor" href="#results-using-summer"></a>
</h5>
<p>The <code>smoothArea</code> function also allows the use of a model
with spatially correlated area effects, but the default implementation
assumes a BYM2 model for <span class="math inline">\(\textbf{u}\)</span>
rather than a simultaneous autoregressive model as in the SFH model
implemented in <code>sae</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create area_name as SUMMER requires rownames of adj.mat to match area variable</span></span>
<span><span class="va">grapes</span><span class="op">$</span><span class="va">area_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'area_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">grapes</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes' not found</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj.mat.grapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">grapesprox</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'as.matrix': object 'grapesprox' not found</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">adj.mat.grapes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">adj.mat.grapes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">grapes</span><span class="op">$</span><span class="va">area_name</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes' not found</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_grapes</span> <span class="op">&lt;-</span> <span class="va">grapes</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'area_name'</span>, <span class="st">'area'</span>, <span class="st">'workdays'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes' not found</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># format direct estimates for SUMMER</span></span>
<span><span class="va">grapes.dir</span> <span class="op">&lt;-</span> <span class="va">grapes</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes' not found</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># scale direct estimates for use with INLA</span></span>
<span><span class="va">grapes.dir</span><span class="op">$</span><span class="va">grapehect</span> <span class="op">&lt;-</span> <span class="va">grapes.dir</span><span class="op">$</span><span class="va">grapehect</span> <span class="op">/</span> <span class="fl">10</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes.dir' not found</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grapes.dir</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="va">grapes.dir</span><span class="op">$</span><span class="va">var</span><span class="op">/</span> <span class="fl">100</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes.dir' not found</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summer.FH.grapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothArea.html">smoothArea</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">grapehect</span><span class="op">~</span><span class="va">area</span> <span class="op">+</span> <span class="va">workdays</span>, </span>
<span>                               direct.est <span class="op">=</span> <span class="va">grapes.dir</span>, X.domain <span class="op">=</span> <span class="va">X_grapes</span>,</span>
<span>                               domain <span class="op">=</span> <span class="op">~</span><span class="va">area_name</span>, adj.mat <span class="op">=</span> <span class="va">adj.mat.grapes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'grapes.dir' not found</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summer.FH.grapes</span>, return_list <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'summer.FH.grapes' not found</span></span></code></pre>
<p>Despite the differing models, we again observe good agreement with
the estimates, though less so with the estimates of uncertainty.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summer.bym2.est</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">summer.FH.grapes</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">adj.mat.grapes</span><span class="op">)</span>, <span class="va">summer.FH.grapes</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">domain</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'summer.FH.grapes' not found</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">eblup.SFH</span>,</span>
<span>     <span class="va">summer.bym2.est</span><span class="op">$</span><span class="va">median</span> <span class="op">*</span> <span class="fl">10</span>,  </span>
<span>     xlab <span class="op">=</span> <span class="st">"sae package"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"SUMMER package"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Small area estimates"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'y' in selecting a method for function 'plot': object 'summer.bym2.est' not found</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new has not been called yet</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">mse</span>,</span>
<span>     <span class="va">summer.bym2.est</span><span class="op">$</span><span class="va">var</span> <span class="op">*</span> <span class="fl">100</span>,  </span>
<span>     xlab <span class="op">=</span> <span class="st">"sae package mse"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"SUMMER package model variance"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Estimates of mse/variance"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'y' in selecting a method for function 'plot': object 'summer.bym2.est' not found</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new has not been called yet</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="brfss-data">BRFSS Data<a class="anchor" aria-label="anchor" href="#brfss-data"></a>
</h4>
<p>Below, we provide an example comparing spatial models from
<code>sae</code> and <code>SUMMER</code> using data from the Behavioral
Risk Factor Surveillance System (BRFSS).</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BRFSS</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KingCounty</span><span class="op">)</span></span>
<span><span class="va">BRFSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">BRFSS</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">BRFSS</span><span class="op">$</span><span class="va">diab2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">BRFSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">BRFSS</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">BRFSS</span><span class="op">$</span><span class="va">hracode</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">BRFSS</span><span class="op">)</span></span>
<span><span class="co">##   age pracex       educau zipcode    sex street1 street2      seqno year</span></span>
<span><span class="co">## 1  30  White college grad   98001   male      NA      NA 2009000041 2009</span></span>
<span><span class="co">## 2  26  White college grad   98107 female      NA      NA 2009000309 2009</span></span>
<span><span class="co">## 3  33  Black college grad   98133   male      NA      NA 2009000404 2009</span></span>
<span><span class="co">## 4  25  White some college   98058   male      NA      NA 2009000531 2009</span></span>
<span><span class="co">## 5  23  White some college   98102   male      NA      NA 2009000675 2009</span></span>
<span><span class="co">## 6  19  Asian some college   98106   male      NA      NA 2009000694 2009</span></span>
<span><span class="co">##   hispanic mracex strata             hracode tract rwt_llcp genhlth2 fmd obese</span></span>
<span><span class="co">## 1 non-Hisp  White  53019        Auburn-North    NA 2107.463        0   0     0</span></span>
<span><span class="co">## 2 non-Hisp  White  53019             Ballard    NA 2197.322        0   1     0</span></span>
<span><span class="co">## 3 non-Hisp  Black  53019          NW Seattle    NA 3086.511        0   0     0</span></span>
<span><span class="co">## 4 non-Hisp  White  53019        Renton-South    NA 3184.740        1   1     1</span></span>
<span><span class="co">## 5 non-Hisp  White  53019 Capitol Hill/E.lake    NA 3184.740        0   0     0</span></span>
<span><span class="co">## 6 non-Hisp  Asian  53019      North Highline    NA 4391.304        0   0     0</span></span>
<span><span class="co">##   smoker1 diab2 aceindx2 zipout streetx ethn age4 ctmiss</span></span>
<span><span class="co">## 1       0     0       NA  98001       0    1    3      1</span></span>
<span><span class="co">## 2       0     0       NA  98107       0    1    3      1</span></span>
<span><span class="co">## 3       0     0       NA  98133       0    2    3      1</span></span>
<span><span class="co">## 4       0     0       NA  98058       0    1    3      1</span></span>
<span><span class="co">## 5       0     0       NA  98102       0    1    4      1</span></span>
<span><span class="co">## 6       0     0       NA  98106       0    3    4      1</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getAmat.html">getAmat</a></span><span class="op">(</span><span class="va">KingCounty</span>, <span class="va">KingCounty</span><span class="op">$</span><span class="va">HRA2010v2_</span><span class="op">)</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">rwt_llcp</span>,</span>
<span>                    strata <span class="op">=</span> <span class="op">~</span><span class="va">strata</span>, data <span class="op">=</span> <span class="va">BRFSS</span><span class="op">)</span></span>
<span><span class="va">direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span><span class="op">~</span><span class="va">diab2</span>, <span class="op">~</span><span class="va">hracode</span>, <span class="va">design</span>, <span class="va">svymean</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="results-using-sae-1">Results using <code>sae</code><a class="anchor" aria-label="anchor" href="#results-using-sae-1"></a>
</h5>
<p>Below, we use <code>sae</code> to smooth the logit-transformed direct
estimates.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">direct</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="va">direct</span><span class="op">$</span><span class="va">se</span> <span class="op">^</span> <span class="fl">2</span></span>
<span><span class="va">direct</span><span class="op">$</span><span class="va">logit.diab2</span> <span class="op">&lt;-</span> <span class="fu">SUMMER</span><span class="fu">::</span><span class="fu"><a href="../../reference/logit.html">logit</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">diab2</span><span class="op">)</span></span>
<span><span class="va">direct</span><span class="op">$</span><span class="va">logit.var</span> <span class="op">&lt;-</span> <span class="va">direct</span><span class="op">$</span><span class="va">var</span> <span class="op">/</span> <span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">diab2</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">direct</span><span class="op">$</span><span class="va">diab2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">SFH.brfss</span> <span class="op">&lt;-</span> <span class="fu">sae</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sae/man/mseSFH.html" class="external-link">mseSFH</a></span><span class="op">(</span><span class="va">logit.diab2</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">logit.var</span>, <span class="va">mat</span>, data <span class="op">=</span> <span class="va">direct</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>domain <span class="op">=</span> <span class="va">direct</span><span class="op">$</span><span class="va">hracode</span>,</span>
<span>                      eblup.SFH <span class="op">=</span> <span class="fu">SUMMER</span><span class="fu">::</span><span class="fu"><a href="../../reference/expit.html">expit</a></span><span class="op">(</span><span class="va">SFH.brfss</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">)</span>, </span>
<span>                      mse <span class="op">=</span> <span class="va">SFH.brfss</span><span class="op">$</span><span class="va">mse</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="results-using-summer-1">Results using <code>SUMMER</code><a class="anchor" aria-label="anchor" href="#results-using-summer-1"></a>
</h5>
<p>Below, we fit two versions of the spatial area levelmodel in
<code>SUMMER</code>. If we change <code>pc.u</code> and
<code>pc.alpha</code> from the default value <span class="math inline">\(u=1,\alpha=0.01\)</span> to <span class="math inline">\(u=0.1,\alpha=0.01\)</span>, we assign more prior
mass on smaller variance of the random effects, inducing more
smoothing.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summer.brfss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothArea.html">smoothArea</a></span><span class="op">(</span><span class="va">diab2</span><span class="op">~</span><span class="fl">1</span>, domain<span class="op">=</span> <span class="op">~</span><span class="va">hracode</span>,</span>
<span>                           design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                           transform <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>                           adj.mat <span class="op">=</span> <span class="va">mat</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">summer.brfss.alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothArea.html">smoothArea</a></span><span class="op">(</span><span class="va">diab2</span><span class="op">~</span><span class="fl">1</span>, domain<span class="op">=</span> <span class="op">~</span><span class="va">hracode</span>,</span>
<span>                               design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                               transform <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>                               adj.mat <span class="op">=</span> <span class="va">mat</span>, level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>                               pc.u <span class="op">=</span> <span class="fl">0.1</span>, pc.alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we use <code><a href="../../reference/mapPlot.html">SUMMER::mapPlot</a></code> to compare median
estimates and uncertainty estimates obtained via <code>sae</code> and
<code>SUMMER</code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">toplot</span> <span class="op">&lt;-</span>  <span class="va">summer.brfss</span><span class="op">$</span><span class="va">bym2.model.est</span></span>
<span><span class="va">toplot</span><span class="op">$</span><span class="va">logit.var</span> <span class="op">&lt;-</span> <span class="va">toplot</span><span class="op">$</span><span class="va">var</span> <span class="op">/</span> </span>
<span>  <span class="op">(</span><span class="va">summer.brfss</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">median</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> </span>
<span>     <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">summer.brfss</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">median</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">toplot</span><span class="op">$</span><span class="va">median.alt</span> <span class="op">&lt;-</span>  <span class="va">summer.brfss.alt</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">median</span></span>
<span><span class="va">toplot</span><span class="op">$</span><span class="va">logit.var.alt</span> <span class="op">&lt;-</span>  <span class="va">summer.brfss.alt</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">var</span> <span class="op">/</span> </span>
<span>  <span class="op">(</span><span class="va">summer.brfss.alt</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">median</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span></span>
<span>     <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">summer.brfss.alt</span><span class="op">$</span><span class="va">bym2.model.est</span><span class="op">$</span><span class="va">median</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">toplot</span><span class="op">$</span><span class="va">median.sae</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">eblup.SFH</span></span>
<span><span class="va">toplot</span><span class="op">$</span><span class="va">mse.sae</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">mse</span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"median.alt"</span>,  <span class="st">"median.sae"</span>,</span>
<span>               <span class="st">"logit.var"</span>, <span class="st">"logit.var.alt"</span>, <span class="st">"mse.sae"</span><span class="op">)</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Median (default prior)"</span>, <span class="st">"Median (new prior)"</span>,  <span class="st">"EBLUP (sae)"</span>,</span>
<span>           <span class="st">"Variance (default prior)"</span>, <span class="st">"Variance (new prior)"</span>, <span class="st">"MSE (sae)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/mapPlot.html">mapPlot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toplot</span>, geo <span class="op">=</span> <span class="va">KingCounty</span>,</span>
<span>        variables<span class="op">=</span><span class="va">variables</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, </span>
<span>        labels <span class="op">=</span> <span class="va">names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, by.data <span class="op">=</span> <span class="st">"domain"</span>,</span>
<span>        by.geo <span class="op">=</span> <span class="st">"HRA2010v2_"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> </span></code></pre></div>
<p><img src="figure/brfss.comp-1.png" width="100%"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/mapPlot.html">mapPlot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">toplot</span>, geo <span class="op">=</span> <span class="va">KingCounty</span>,</span>
<span>        variables<span class="op">=</span><span class="va">variables</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, labels <span class="op">=</span> <span class="va">names</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>        by.data <span class="op">=</span> <span class="st">"domain"</span>, by.geo <span class="op">=</span> <span class="st">"HRA2010v2_"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="figure/brfss.comp-2.png" width="100%"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">range1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">diab2</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">median.alt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">diab2</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">median</span>,  </span>
<span>     xlab <span class="op">=</span> <span class="st">"direct estimates"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"model-based estimates"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Small area estimates"</span>, col <span class="op">=</span> <span class="st">'red'</span>, pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     xlim<span class="op">=</span><span class="va">range1</span>,ylim<span class="op">=</span><span class="va">range1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">diab2</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">median.sae</span>,  col <span class="op">=</span> <span class="st">'blue'</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">diab2</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">median.alt</span>,  col <span class="op">=</span> <span class="st">'cyan'</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">'topleft'</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red'</span>, <span class="st">'cyan'</span>, <span class="st">'blue'</span><span class="op">)</span>, </span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SUMMER"</span>,<span class="st">'SUMMER (new prior)'</span>, <span class="st">"sae"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">range2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">logit.var</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">mse.sae</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">logit.var.alt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">logit.var</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">logit.var</span>,  </span>
<span>     xlab <span class="op">=</span> <span class="st">"direct estimate var."</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"model-based uncertainty"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Small area estimates"</span>, col <span class="op">=</span> <span class="st">'red'</span>, pch <span class="op">=</span> <span class="fl">16</span>, </span>
<span>     xlim<span class="op">=</span><span class="va">range2</span>,ylim<span class="op">=</span><span class="va">range2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">logit.var</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">mse.sae</span>,  col <span class="op">=</span> <span class="st">'blue'</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">direct</span><span class="op">$</span><span class="va">logit.var</span>,<span class="va">toplot</span><span class="op">$</span><span class="va">logit.var.alt</span>,  col <span class="op">=</span> <span class="st">'cyan'</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">'topleft'</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red'</span>, <span class="st">'cyan'</span>,<span class="st">'blue'</span><span class="op">)</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SUMMER var."</span>, <span class="st">'SUMMER var. (new prior)'</span>, <span class="st">"sae mse"</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/brfss.comp.2-1.png" width="100%"></p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="unit-level-models">Unit Level Models<a class="anchor" aria-label="anchor" href="#unit-level-models"></a>
</h2>
<p>The nested error model, introduced by <span class="citation">Battese,
Harter, and Fuller (1988)</span>, uses auxiliary data at the unit
level.</p>
<p><strong>Nested error model:</strong> <span class="math display">\[y_{dk}=\mathbf{x}_{dk}^T\boldsymbol\beta+u_d+\epsilon_{dk},\hspace{1em}u_d\sim_{ind}N(0,\sigma_u^2),\hspace{1em}\epsilon_{dk}\sim_{ind}N(0,\sigma_\epsilon^2)\]</span></p>
<p>Here <span class="math inline">\(u_d\)</span> are area random effects
and <span class="math inline">\(\epsilon_{dk}\)</span> are unit level
errors. This model assumes the sampling design is ignorable.</p>
<p>The <code>sae</code> package conducts estimation of domain means by
first estimating variance parameters <span class="math inline">\(\sigma^2_u\)</span> and <span class="math inline">\(\sigma^2_\epsilon\)</span>. Next, given known
variance parameters, domain means <span class="math inline">\(\theta_d\)</span> are predicted by calculating the
EBLUPs.</p>
<p>The area fitted values are: <span class="math display">\[\widehat{y}_d^{\text{EBLUP}} = f_d
\overline{y}_{dS} + (\overline{X}_d-f_d
\overline{x}_{dS})\widehat{\beta} + (1-f_d)\widehat{u}_d,\]</span>
where</p>
<ul>
<li><p><span class="math inline">\(f_d=n_d/N_d\)</span> is the domain
sampling fraction.</p></li>
<li><p><span class="math inline">\(\overline{y}_{dS}\)</span> is the
mean response in the sampled units.</p></li>
<li><p><span class="math inline">\(\overline{x}_{dS}\)</span> is the
mean of the covariates in the sampled units.</p></li>
<li><p><span class="math inline">\(\overline{X}_d\)</span> is the mean
of the covariates in the population.</p></li>
<li><p><span class="math inline">\(\widehat{u}_d\)</span> is the
estimated random effect.</p></li>
</ul>
<div class="section level3">
<h3 id="corn-and-soy-production">Corn and Soy Production<a class="anchor" aria-label="anchor" href="#corn-and-soy-production"></a>
</h3>
<p>The <code>cornsoybean</code> and <code>cornsoybeanmeans</code>
datasets contain info on corn and soy beans production in 12 Iowa
counties <span class="citation">Battese, Harter, and Fuller
(1988)</span>. The objective here is use satellite imagery of the number
of pixels assigned to corn and soy to estimate the hectares grown of
corn.</p>
<ul>
<li>
<code>SampSegments</code>: sample size.</li>
<li>
<code>PopnSegments</code>: population size.</li>
<li>
<code>MeanCornPixPerSeg</code>: county mean of the number of corn
pixels (satellite imagery).</li>
<li>
<code>MeanSoyBeansPixPerSeg</code> county mean of the number of soy
beans (satellite imagery) pixels.</li>
</ul>
<p>The variables <code>MeanCornPixPerSeg</code> and
<code>MeanSoyBeansPixPerSeg</code> provide the known county means of the
auxiliary variables.</p>
<p>We load the sample data:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cornsoybean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cornsoybean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   County CornHec SoyBeansHec CornPix SoyBeansPix</span></span>
<span><span class="co">## 1      1  165.76        8.09     374          55</span></span>
<span><span class="co">## 2      2   96.32      106.03     209         218</span></span>
<span><span class="co">## 3      3   76.08      103.60     253         250</span></span>
<span><span class="co">## 4      4  185.35        6.47     432          96</span></span>
<span><span class="co">## 5      4  116.43       63.82     367         178</span></span>
<span><span class="co">## 6      5  162.08       43.50     361         137</span></span></code></pre>
<p>Next, we load the population auxiliary information:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cornsoybeanmeans"</span><span class="op">)</span></span>
<span><span class="va">Xmean</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">cornsoybeanmeans</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CountyIndex"</span>,</span>
<span>                                  <span class="st">"MeanCornPixPerSeg"</span>,</span>
<span>                                  <span class="st">"MeanSoyBeansPixPerSeg"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Xmean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   CountyIndex MeanCornPixPerSeg MeanSoyBeansPixPerSeg</span></span>
<span><span class="co">## 1           1            295.29                189.70</span></span>
<span><span class="co">## 2           2            300.40                196.65</span></span>
<span><span class="co">## 3           3            289.60                205.28</span></span>
<span><span class="co">## 4           4            290.74                220.22</span></span>
<span><span class="co">## 5           5            318.21                188.06</span></span>
<span><span class="co">## 6           6            257.17                247.13</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Popn</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">cornsoybeanmeans</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CountyIndex"</span>,</span>
<span>                                  <span class="st">"PopnSegments"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Popn</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   CountyIndex PopnSegments</span></span>
<span><span class="co">## 1           1          545</span></span>
<span><span class="co">## 2           2          566</span></span>
<span><span class="co">## 3           3          394</span></span>
<span><span class="co">## 4           4          424</span></span>
<span><span class="co">## 5           5          564</span></span>
<span><span class="co">## 6           6          570</span></span></code></pre>
<p>The <code><a href="https://rdrr.io/pkg/sae/man/pbmseBHF.html" class="external-link">sae::pbmseBHF</a></code> function obtains EBLUPs under the
nested error model and then uses a parametric bootstrap approach to
estimate MSEs.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cornsoybean</span> <span class="op">&lt;-</span> <span class="va">cornsoybean</span><span class="op">[</span><span class="op">-</span><span class="fl">33</span>, <span class="op">]</span> <span class="co"># remove outlier</span></span>
<span><span class="va">sae.bhf</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sae/man/pbmseBHF.html" class="external-link">pbmseBHF</a></span><span class="op">(</span><span class="va">CornHec</span> <span class="op">~</span> <span class="va">CornPix</span> <span class="op">+</span> <span class="va">SoyBeansPix</span>,</span>
<span>           dom <span class="op">=</span> <span class="va">County</span>, meanxpop <span class="op">=</span> <span class="va">Xmean</span>,</span>
<span>           popnsize <span class="op">=</span> <span class="va">Popn</span>, B <span class="op">=</span> <span class="fl">200</span>, </span>
<span>           data <span class="op">=</span> <span class="va">cornsoybean</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../../reference/smoothUnit.html">SUMMER::smoothUnit</a></code> provides the ability to fit unit
level models with unit level covariates for Gaussian response variables.
Below we use the <code>is.unit</code> argument to specify a unit level
model and then provide the column names of the unit level covariates in
<code>X.unit</code>. Finally, the <code>X</code> argument provides the
area level means of each covariate for use when generating predictions.
Note that in order to align the <code>SUMMER</code> estimates with those
from the <code>sae</code> package, we specify a relatively flat prior on
the variance of the area-specific random effect
(<code>pc.u = 100, pc.alpha = 0.01</code> specifies a penalized
complexity prior such that <span class="math inline">\(P(\sigma_u &gt;
100)=0.01\)</span> where <span class="math inline">\(\sigma_u\)</span>
is the standard deviation of the area-specific random effects).</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cornsoybean</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cornsoybean</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Xsummer</span> <span class="op">&lt;-</span> <span class="va">Xmean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Xsummer</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"County"</span>, <span class="st">"CornPix"</span>, <span class="st">"SoyBeansPix"</span><span class="op">)</span></span>
<span><span class="va">des0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">cornsoybean</span><span class="op">)</span></span>
<span><span class="co">## Warning in svydesign.default(ids = ~1, data = cornsoybean): No weights or</span></span>
<span><span class="co">## probabilities supplied, assuming equal probability</span></span>
<span><span class="va">summer.bhf.unit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothUnit.html">smoothUnit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">CornHec</span> <span class="op">~</span> <span class="va">CornPix</span> <span class="op">+</span> <span class="va">SoyBeansPix</span>,</span>
<span>                              family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                              domain <span class="op">=</span> <span class="op">~</span><span class="va">County</span>,</span>
<span>                              design <span class="op">=</span> <span class="va">des0</span>, X.pop <span class="op">=</span> <span class="va">Xsummer</span>,</span>
<span>                              pc.u <span class="op">=</span> <span class="fl">1000</span>, pc.alpha <span class="op">=</span> <span class="fl">0.01</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">## Warning in smoothUnit(formula = CornHec ~ CornPix + SoyBeansPix, family =</span></span>
<span><span class="co">## "gaussian", : No spatial information provided, using iid domain effects</span></span></code></pre></div>
<p>Below, we plot comparisons of the <code>sae</code> and
<code>SUMMER</code> results.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">range1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sae.bhf</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">$</span><span class="va">eblup</span>,<span class="va">summer.bhf.unit</span><span class="op">$</span><span class="va">median</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sae.bhf</span><span class="op">$</span><span class="va">est</span><span class="op">$</span><span class="va">eblup</span><span class="op">$</span><span class="va">eblup</span>,<span class="va">summer.bhf.unit</span><span class="op">$</span><span class="va">iid.model.est</span><span class="op">$</span><span class="va">median</span>,  </span>
<span>     xlab <span class="op">=</span> <span class="st">"sae package"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"SUMMER unit-level model package"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Small area estimates"</span>,</span>
<span>     xlim<span class="op">=</span><span class="va">range1</span>,ylim<span class="op">=</span><span class="va">range1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">range2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sae.bhf</span><span class="op">$</span><span class="va">mse</span><span class="op">$</span><span class="va">mse</span>, <span class="va">summer.bhf.unit</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sae.bhf</span><span class="op">$</span><span class="va">mse</span><span class="op">$</span><span class="va">mse</span>, <span class="va">summer.bhf.unit</span><span class="op">$</span><span class="va">iid.model.est</span><span class="op">$</span><span class="va">var</span>,  </span>
<span>     xlab <span class="op">=</span> <span class="st">"sae package mse"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"SUMMER unit-level model package model variance"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Estimates of mse/variance"</span>,</span>
<span>     xlim<span class="op">=</span><span class="va">range2</span>,ylim<span class="op">=</span><span class="va">range2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/bhf.unit.comp-1.png" width="100%"></p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-battese_error-components_1988" class="csl-entry">
Battese, George E, Rachel M Harter, and Wayne A Fuller. 1988. <span>“An
Error-Components Model for Prediction of County Crop Areas Using Survey
and Satellite Data.”</span> <em>Journal of the American Statistical
Association</em> 83: 28–36.
</div>
<div id="ref-fay1979" class="csl-entry">
Fay, R. E., and R. A. Herriot. 1979. <span>“Estimates of Income for
Small Places: An Application of <span>James–Stein</span> Procedure to
Census Data.”</span> <em>Journal of the American Statistical
Association</em> 74: 269–77.
</div>
<div id="ref-kreutzmann2019" class="csl-entry">
Kreutzmann, Ann-Kristin, Sören Pannier, Natalia Rojas-Perilla, Timo
Schmid, Matthias Templ, and Nikos Tzavidis. 2019. <span>“The r Package
Emdi for Estimating and Mapping Regionally Disaggregated
Indicators.”</span> <em>Journal of Statistical Software</em> 91.
</div>
<div id="ref-molina2015" class="csl-entry">
Molina, Isabel, and Yolanda Marhuenda. 2015. <span>“Sae: <span>An</span>
<span>R</span> <span>Package</span> for <span>Small</span>
<span>Area</span> <span>Estimation</span>.”</span> <em>The R
Journal</em> 7: 81–98.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zehang R Li, Bryan D Martin, Yuan Hsiao, Jessica Godwin, John Paige, Peter Gao, Jon Wakefield, Samuel J Clark, Geir-Arne Fuglstad, Andrea Riebler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
