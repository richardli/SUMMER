<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SUMMER">
<title>Estimating Subnational U5MR using Simulated Data • SUMMER</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Estimating Subnational U5MR using Simulated Data">
<meta property="og:description" content="SUMMER">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">SUMMER</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/web_only/small-area-estimation.html">Generic small area estimation</a>
    <a class="dropdown-item" href="../../articles/web_only/u5mr-vignette.html">Estimating Subnational U5MR using Simulated Data</a>
    <a class="dropdown-item" href="../../articles/web_only/u5mr-dhs-vignette.html">Estimating Subnational U5MR using DHS Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/richardli/SUMMER/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimating Subnational U5MR using Simulated Data</h1>
                        <h4 data-toc-skip class="author">Zehang Richard
Li</h4>
            
            <h4 data-toc-skip class="date">2024-02-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/richardli/SUMMER/blob/HEAD/vignettes/articles/web_only/u5mr-vignette.Rmd" class="external-link"><code>vignettes/articles/web_only/u5mr-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>u5mr-vignette.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will discuss the use of both area and
cluster-level models using the SUMMER package. We will use the simulated
surveys in the <code>DemoData</code> dataset in the package. The
<code>DemoData</code> object is a list that contains full birth history
data from simulated surveys with stratified cluster sampling design,
similar to most of the DHS surveys. It has been pre-processed into the
person-month format, where for each list entry, each row represents one
person-month record. Each record contains columns for the cluster ID
(<code>clustid</code>), household ID (<code>id</code>), strata
membership (<code>strata</code>) and survey weights
(<code>weights</code>). The region and time period associated with each
person-month record has also been computed and saved in the dataset. Raw
DHS data can be processed into this format using the
<code>getBirths</code> function.</p>
<div class="section level2">
<h2 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>We first load the package and data. We will use the
<strong>dplyr</strong> package in some data processing steps, and
<strong>ggplot2</strong> and <strong>patchwork</strong> for
visualization.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/richardli/SUMMER" class="external-link">SUMMER</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p><code>DemoData</code> contains model survey data provided by DHS.
Note that this data is simulated and does not represent any real
country’s data. <code>DemoData</code> is obtained by processing the raw
DHS birth data (in .dta format) in R. The raw file of birth recodes can
be downloaded from the DHS website <a href="https://dhsprogram.com/data/Download-Model-Datasets.cfm" class="external-link">https://dhsprogram.com/data/Download-Model-Datasets.cfm</a>.
For this demo dataset, no registration is needed. For real DHS survey
datasets, permission to access needs to be registered with DHS directly.
<code>DemoData</code> contains a small sample of the observations in
this dataset randomly assigned to <span class="math inline">\(5\)</span>
example DHS surveys.</p>
<p>For more details, the following code snippet demonstrates how to
split the raw demo data into person-month format from similar to that in
the <code>DemoData</code> object. Notice that to read the file from
early version of stata, the package <code>readstata13</code> is
required. The following script is based on the example dataset
<code>ZZBR62FL.DTA</code> available from the DHS website. We use the
interaction of v024 and v025 as the strata indicator for the purpose of
demonstration. We can see from <code>range(data$v008)</code> that the
CMC code for the date of interview corresponds to the year
<code>1900 + floor(1386/12)= 2015</code>. In practice, however, the
survey year is usually known. The survey year variable allows the
mis-recorded data. Dates after the <code>surveyyear</code> will be
removed. Thus for survey taking place over multiple years, the later
year is suggested to be used as <code>surveyyear</code>. If set to NA
then no checking will be performed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjewo/readstata13" class="external-link">readstata13</a></span><span class="op">)</span></span>
<span><span class="va">my_fp</span> <span class="op">&lt;-</span> <span class="st">"data/ZZBR62DT/ZZBR62FL.DTA"</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getBirths.html">getBirths</a></span><span class="op">(</span>filepath <span class="op">=</span> <span class="va">my_fp</span>, surveyyear <span class="op">=</span> <span class="fl">2015</span>, strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v024"</span>, <span class="st">"v025"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v001"</span>, <span class="st">"v002"</span>, <span class="st">"v024"</span>, <span class="st">"per5"</span>, <span class="st">"ageGrpD"</span>, <span class="st">"v005"</span>, <span class="st">"strata"</span>, <span class="st">"died"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clustid"</span>, <span class="st">"id"</span>, <span class="st">"region"</span>, <span class="st">"time"</span>, <span class="st">"age"</span>, <span class="st">"weights"</span>, <span class="st">"strata"</span>,</span>
<span>    <span class="st">"died"</span><span class="op">)</span></span></code></pre></div>
<p>Back to the pre-processed dataset, <code>DemoData</code> is a list of
<span class="math inline">\(5\)</span> data frames where each row
represent one person-month record and contains the <span class="math inline">\(8\)</span> variables as shown below. Notice that
<code>time</code> variable is turned into 5-year bins from
<code>80-84</code> to <code>10-14</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Length Class      Mode</span></span>
<span><span class="co">## 1999 8      data.frame list</span></span>
<span><span class="co">## 2003 8      data.frame list</span></span>
<span><span class="co">## 2007 8      data.frame list</span></span>
<span><span class="co">## 2011 8      data.frame list</span></span>
<span><span class="co">## 2015 8      data.frame list</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   clustid id  region  time  age weights        strata died</span></span>
<span><span class="co">## 1       1  1 eastern 00-04    0     1.1 eastern.rural    0</span></span>
<span><span class="co">## 2       1  1 eastern 00-04 1-11     1.1 eastern.rural    0</span></span>
<span><span class="co">## 3       1  1 eastern 00-04 1-11     1.1 eastern.rural    0</span></span>
<span><span class="co">## 4       1  1 eastern 00-04 1-11     1.1 eastern.rural    0</span></span>
<span><span class="co">## 5       1  1 eastern 00-04 1-11     1.1 eastern.rural    0</span></span>
<span><span class="co">## 6       1  1 eastern 00-04 1-11     1.1 eastern.rural    0</span></span></code></pre>
<p>For demonstration purpose, we associate the regions in this simulated
dataset with an example map stored in the <code>DemoMap</code> object in
the SUMMER package. <code>DemoMap</code> contains geographic data from
the 1995 Uganda Admin 1 regions defined by DHS. It contains a
SpatialPolygonsDataFrame object <code>geo</code> and the corresponding
spatial adjacency matrix <code>mat</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DemoMap</span><span class="op">)</span></span>
<span><span class="va">geo</span> <span class="op">&lt;-</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">geo</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">Amat</span></span></code></pre></div>
<p>The spatial adjacency matrix can also be created directly from the
SpatialPolygonsDataFrame by</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getAmat.html">getAmat</a></span><span class="op">(</span><span class="va">geo</span>, <span class="va">geo</span><span class="op">$</span><span class="va">REGNAME</span><span class="op">)</span></span></code></pre></div>
<p>Finally, more details on the pipeline of downloading and processing
raw DHS data and shapefiles can be found in the vignette <em>A Case
Study of Estimating Subnational U5MR using DHS data</em>.</p>
</div>
<div class="section level2">
<h2 id="direct-estimates">Direct estimates<a class="anchor" aria-label="anchor" href="#direct-estimates"></a>
</h2>
<p>First, we obtain Horvitz-Thompson estimators using
<code>getDirectList</code>. We specify the survey design as the
two-stage stratified cluster sampling where strata are specified in the
<code>strata</code> column, and clusters are specified by both the
cluster ID (<code>clusterid</code>) and household ID
(<code>id</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="va">data_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getDirectList.html">getDirectList</a></span><span class="op">(</span>births <span class="op">=</span> <span class="va">DemoData</span>, years <span class="op">=</span> <span class="va">years</span>, regionVar <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>    timeVar <span class="op">=</span> <span class="st">"time"</span>, clusterVar <span class="op">=</span> <span class="st">"~clustid+id"</span>, ageVar <span class="op">=</span> <span class="st">"age"</span>, weightsVar <span class="op">=</span> <span class="st">"weights"</span>,</span>
<span>    geo.recode <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>Before fitting the model, we also aggregate estimates based on
different surveys into a single set of estimates, using the inverse
design-based variances as the weights.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data_multi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 150  10</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/aggregateSurvey.html">aggregateSurvey</a></span><span class="op">(</span><span class="va">data_multi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 30 10</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="area-level-model-for-u5mr">Area-level model for U5MR<a class="anchor" aria-label="anchor" href="#area-level-model-for-u5mr"></a>
</h2>
<div class="section level3">
<h3 id="national-estimates-of-u5mr">National estimates of U5MR<a class="anchor" aria-label="anchor" href="#national-estimates-of-u5mr"></a>
</h3>
<p>With the combined direct estimates, we are ready to fit the smoothing
models described in <span class="citation">Li et al. (2019)</span>.
First, we ignore the subnational estimates, and fit a model with
temporal random effects only. In this part, we use the subset of data
region variable being “All”. In fitting this model, we first define the
list of time periods we wish to project the estimates on. First we can
fit a Random Walk 2 only model defined on the 5-year period. The
argument <code>m = 1</code> specifies that the random walk is in the
same temporal resolution as the input data. See the next example for the
case where the random walk model is specified at a higher
resolution.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">years.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">years</span>, <span class="st">"15-19"</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothDirect.html">smoothDirect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, Amat <span class="op">=</span> <span class="cn">NULL</span>, year_label <span class="op">=</span> <span class="va">years.all</span>, year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span>,</span>
<span>    <span class="fl">2019</span><span class="op">)</span>, time.model <span class="op">=</span> <span class="st">"rw2"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Smoothed Direct Model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     35</span></span>
<span><span class="co">##   Temporal resolution:        period model (m = 1)</span></span>
<span><span class="co">## ----------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Smoothed Direct Model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     35</span></span>
<span><span class="co">##   Temporal resolution:        period model (m = 1)</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Fixed Effects</span></span>
<span><span class="co">##             mean    sd 0.025quant 0.5quant 0.97quant mode kld</span></span>
<span><span class="co">## (Intercept) -1.4 0.081       -1.6     -1.4      -1.3 -1.4   0</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Random Effects</span></span>
<span><span class="co">##            Name     Model</span></span>
<span><span class="co">## 1   time.struct RW2 model</span></span>
<span><span class="co">## 2 time.unstruct IID model</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Model hyperparameters</span></span>
<span><span class="co">##                             mean   sd 0.025quant 0.5quant 0.97quant mode</span></span>
<span><span class="co">## Precision for time.struct   1212 9510        5.4      140      6882  9.8</span></span>
<span><span class="co">## Precision for time.unstruct 1191 6732       11.2      207      6959 23.3</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">##                                       [,1]</span></span>
<span><span class="co">## log marginal-likelihood (integration) -2.1</span></span>
<span><span class="co">## log marginal-likelihood (Gaussian)    -1.9</span></span></code></pre>
<p>When data is sparse, direct estimates at yearly level may be
unstable. This is why we used 5-year periods as the model’s temporal
resolution in this example. When performing temporal smoothing, however,
we can define the temporal smoother on the yearly scale instead. Notice
that the direct estimates are still calculated in 5-year intervals, but
the smoothed estimator now produce estimates at both yearly and period
resolutions.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothDirect.html">smoothDirect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, Amat <span class="op">=</span> <span class="cn">NULL</span>, year_label <span class="op">=</span> <span class="va">years.all</span>, year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span>,</span>
<span>    <span class="fl">2019</span><span class="op">)</span>, time.model <span class="op">=</span> <span class="st">"rw2"</span>, m <span class="op">=</span> <span class="fl">5</span>, type.st <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Smoothed Direct Model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     35</span></span>
<span><span class="co">##   Temporal resolution:        yearly model (m = 5)</span></span>
<span><span class="co">## ----------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Smoothed Direct Model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     35</span></span>
<span><span class="co">##   Temporal resolution:        yearly model (m = 5)</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Fixed Effects</span></span>
<span><span class="co">##             mean    sd 0.025quant 0.5quant 0.97quant mode kld</span></span>
<span><span class="co">## (Intercept) -1.4 0.074       -1.6     -1.4      -1.3 -1.4   0</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Random Effects</span></span>
<span><span class="co">##            Name     Model</span></span>
<span><span class="co">## 1   time.struct RGeneric2</span></span>
<span><span class="co">## 2 time.unstruct RGeneric2</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Model hyperparameters</span></span>
<span><span class="co">##                          mean  sd 0.025quant 0.5quant 0.97quant mode</span></span>
<span><span class="co">## Theta1 for time.struct    5.0 1.9        1.6      5.0       8.8  4.6</span></span>
<span><span class="co">## Theta1 for time.unstruct  4.3 1.8        1.1      4.2       7.8  3.9</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">##                                       [,1]</span></span>
<span><span class="co">## log marginal-likelihood (integration)  -75</span></span>
<span><span class="co">## log marginal-likelihood (Gaussian)     -75</span></span></code></pre>
<p>The marginal posteriors are already stored in the fitted object. We
use the following function to extract and re-arrange them.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<p>We can compare the results visually using the function below.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"National period model"</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"National yearly model"</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">+</span> <span class="va">g2</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-12-1.png" width="90%"></p>
</div>
<div class="section level3">
<h3 id="subnational-estimates-of-u5mr">Subnational estimates of U5MR<a class="anchor" aria-label="anchor" href="#subnational-estimates-of-u5mr"></a>
</h3>
<p>Now we fit the full model on all subnational regions. First, we use
the Random Walk 2 model defined on the 5-year period.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothDirect.html">smoothDirect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, Amat <span class="op">=</span> <span class="va">mat</span>, year_label <span class="op">=</span> <span class="va">years.all</span>, year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span>,</span>
<span>    <span class="fl">2019</span><span class="op">)</span>, time.model <span class="op">=</span> <span class="st">"rw2"</span>, m <span class="op">=</span> <span class="fl">1</span>, type.st <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Smoothed Direct Model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     35</span></span>
<span><span class="co">##   Temporal resolution:        period model (m = 1)</span></span>
<span><span class="co">##   Spatial effect:             bym2</span></span>
<span><span class="co">##   Number of regions:          4</span></span>
<span><span class="co">##   Interaction temporal model: rw2</span></span>
<span><span class="co">##   Interaction type:           4</span></span>
<span><span class="co">## ----------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></code></pre></div>
<p>Similarly we can also estimate the Random Walk 2 random effects on
the yearly scale.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothDirect.html">smoothDirect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, Amat <span class="op">=</span> <span class="va">mat</span>, year_label <span class="op">=</span> <span class="va">years.all</span>, year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span>,</span>
<span>    <span class="fl">2019</span><span class="op">)</span>, time.model <span class="op">=</span> <span class="st">"rw2"</span>, m <span class="op">=</span> <span class="fl">5</span>, type.st <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Smoothed Direct Model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     35</span></span>
<span><span class="co">##   Temporal resolution:        yearly model (m = 5)</span></span>
<span><span class="co">##   Spatial effect:             bym2</span></span>
<span><span class="co">##   Number of regions:          4</span></span>
<span><span class="co">##   Interaction temporal model: rw2</span></span>
<span><span class="co">##   Interaction type:           4</span></span>
<span><span class="co">## ----------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit4</span><span class="op">)</span></span></code></pre></div>
<p>The figures below shows the comparison of the subnational model with
different temporal scales.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out3</span>, is.yearly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Subnational period model"</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out4</span>, is.yearly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Subnational yearly model"</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">+</span> <span class="va">g2</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-15-1.png" width="90%"></p>
<p>We can also add back the direct estimates for comparison when
plotting the smoothed estimates.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out4</span>, is.yearly <span class="op">=</span> <span class="cn">TRUE</span>, data.add <span class="op">=</span> <span class="va">data_multi</span>, option.add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>point <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"surveyYears"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">region</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-16-1.png" width="90%"></p>
<p>Finally, we show the estimates over time on maps.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/mapPlot.html">mapPlot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">out4</span>, <span class="va">is.yearly</span> <span class="op">==</span> <span class="cn">F</span><span class="op">)</span>, geo <span class="op">=</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">geo</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"years"</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span><span class="op">)</span>, by.data <span class="op">=</span> <span class="st">"region"</span>, by.geo <span class="op">=</span> <span class="st">"NAME_final"</span>, is.long <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-17-1.png" width="90%"></p>
</div>
</div>
<div class="section level2">
<h2 id="cluster-level-model-for-u5mr">Cluster-level model for U5MR<a class="anchor" aria-label="anchor" href="#cluster-level-model-for-u5mr"></a>
</h2>
<p>We now describe the fitting of the cluster-level model for U5MR
described in <span class="citation">Martin et al. (2020)</span> and
<span class="citation">Fuglstad, Li, and Wakefield (2021)</span>. For
this simulated dataset, the strata variable is coded as region crossed
by urban/rural status. For our analysis with urban/rural stratified
model, we first construct a new strata variable that contains only the
urban/rural status, i.e., the additional stratification within each
region.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">strata</span> <span class="op">&lt;-</span> <span class="va">DemoData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">strata</span></span>
<span>    <span class="va">DemoData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">strata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"urban"</span>, <span class="va">strata</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"urban"</span></span>
<span>    <span class="va">DemoData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">strata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"rural"</span>, <span class="va">strata</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"rural"</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To fit the cluster-level model, we calculate the number of
person-months and number of deaths for each cluster, time period, and
age group. We first create the data frame using the
<code>getCounts</code> function for each survey and combine them into a
single data frame.</p>
<p>The model fitting function <code>smoothCluster</code> expects columns
with specific names. We rename the cluster ID and time period columns to
be ‘cluster’ and ‘years’. The response variable is ‘Y’ and the binomial
total is ‘total’.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts.all</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clustid"</span>, <span class="st">"region"</span>, <span class="st">"strata"</span>, <span class="st">"time"</span>, <span class="st">"age"</span><span class="op">)</span></span>
<span>    <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getCounts.html">getCounts</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span>, <span class="st">"died"</span><span class="op">)</span><span class="op">]</span>, variables <span class="op">=</span> <span class="st">"died"</span>, by <span class="op">=</span> <span class="va">vars</span>,</span>
<span>        drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">counts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="va">clustid</span>, years <span class="op">=</span> <span class="va">time</span>, Y <span class="op">=</span> <span class="va">died</span><span class="op">)</span></span>
<span>    <span class="va">counts</span><span class="op">$</span><span class="va">survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DemoData</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">counts.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">counts.all</span>, <span class="va">counts</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>With the created data frame, we fit the cluster-level model using the
<code>smoothCluster</code> function. Notice that here we need to specify
the age groups (<code>age.groups</code>), the length of each age group
(<code>age.n</code>) in months, and how the age groups are mapped to the
temporal random effects (<code>age.rw.group</code>). In the default
case, <code>age.rw.group = c(1, 2, 3, 3, 3, 3)</code> means the first
two age groups each has its own temporal trend, the the following four
age groups share the same temporal trend. We start with the default
temporal model of random walk or order 2 on the 5-year periods in this
dataset (with real data, we can use a finer temporal resolution). For
the space-time interaction, we use an AR(1) prior (specified by
<code>st.time.model</code>) interacting with a spatial ICAR prior, with
random linear trends in each area (specified by
<code>pc.st.slope.u</code> and <code>pc.st.slope.alpha</code>). We add
survey iid effects to the model as well using
<code>survey.effect = TRUE</code> argument. The temporal main effects
are defined for each stratum separately (specified by
<code>strata.time.effect = TRUE</code>, so in total six random walks are
used to model the main temporal effect.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"85-89"</span>, <span class="st">"90-94"</span>, <span class="st">"95-99"</span>, <span class="st">"00-04"</span>, <span class="st">"05-09"</span>, <span class="st">"10-14"</span><span class="op">)</span></span>
<span><span class="va">fit.bb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/smoothCluster.html">smoothCluster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">counts.all</span>, Amat <span class="op">=</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">Amat</span>, </span>
<span>                    family <span class="op">=</span> <span class="st">"betabinomial"</span>,</span>
<span>                    year_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">periods</span>, <span class="st">"15-19"</span><span class="op">)</span>, </span>
<span>                    age.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1-11"</span>, <span class="st">"12-23"</span>, <span class="st">"24-35"</span>, <span class="st">"36-47"</span>, <span class="st">"48-59"</span><span class="op">)</span>,</span>
<span>                    age.n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">12</span>, <span class="fl">12</span>, <span class="fl">12</span><span class="op">)</span>,</span>
<span>                    age.rw.group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                    time.model <span class="op">=</span> <span class="st">"rw2"</span>,</span>
<span>                    st.time.model <span class="op">=</span> <span class="st">"ar1"</span>,</span>
<span>                    pc.st.slope.u <span class="op">=</span> <span class="fl">1</span>, pc.st.slope.alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                    survey.effect <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    strata.time.effect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Argument 'age.rw.group' have been deprecated and replaced by 'age.time.group' in version 1.4.0. The value for 'age.time.group' has been set to be the input argument 'age.rw.group'</span></span></code></pre>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Cluster-level model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     7</span></span>
<span><span class="co">##   Spatial effect:             bym2</span></span>
<span><span class="co">##   Number of regions:          4</span></span>
<span><span class="co">##   Interaction temporal model: ar1</span></span>
<span><span class="co">##   Interaction type:           4</span></span>
<span><span class="co">##   Interaction random slopes:  yes</span></span>
<span><span class="co">##   Number of age groups: 6</span></span>
<span><span class="co">##   Stratification: yes</span></span>
<span><span class="co">##   Number of age-specific fixed effect intercept per stratum: 6</span></span>
<span><span class="co">##   Number of age-specific trends per stratum: 3</span></span>
<span><span class="co">##   Strata-specific temporal trends: yes</span></span>
<span><span class="co">##   Survey effect: yes</span></span>
<span><span class="co">## ----------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit.bb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Cluster-level model</span></span>
<span><span class="co">##   Main temporal model:        rw2</span></span>
<span><span class="co">##   Number of time periods:     7</span></span>
<span><span class="co">##   Spatial effect:             bym2</span></span>
<span><span class="co">##   Number of regions:          4</span></span>
<span><span class="co">##   Interaction temporal model: ar1</span></span>
<span><span class="co">##   Interaction type:           4</span></span>
<span><span class="co">##   Interaction random slopes:  yes</span></span>
<span><span class="co">##   Number of age groups: 6</span></span>
<span><span class="co">##   Stratification: yes</span></span>
<span><span class="co">##   Number of age group fixed effect intercept per stratum: 6</span></span>
<span><span class="co">##   Number of age-specific trends per stratum: 3</span></span>
<span><span class="co">##   Strata-specific temporal trends: yes</span></span>
<span><span class="co">##   Survey effect: yes</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Fixed Effects</span></span>
<span><span class="co">##                          mean   sd 0.025quant 0.5quant 0.97quant mode kld</span></span>
<span><span class="co">## age.intercept0:rural     -3.0 0.14       -3.3     -3.0      -2.7 -3.0   0</span></span>
<span><span class="co">## age.intercept1-11:rural  -4.7 0.11       -4.9     -4.7      -4.5 -4.7   0</span></span>
<span><span class="co">## age.intercept12-23:rural -5.8 0.14       -6.1     -5.8      -5.5 -5.8   0</span></span>
<span><span class="co">## age.intercept24-35:rural -6.6 0.20       -6.9     -6.6      -6.2 -6.6   0</span></span>
<span><span class="co">## age.intercept36-47:rural -6.9 0.23       -7.3     -6.9      -6.4 -6.9   0</span></span>
<span><span class="co">## age.intercept48-59:rural -7.3 0.29       -7.9     -7.3      -6.8 -7.3   0</span></span>
<span><span class="co">## age.intercept0:urban     -2.7 0.13       -3.0     -2.7      -2.5 -2.7   0</span></span>
<span><span class="co">## age.intercept1-11:urban  -5.0 0.13       -5.2     -5.0      -4.7 -5.0   0</span></span>
<span><span class="co">## age.intercept12-23:urban -5.7 0.17       -6.1     -5.7      -5.4 -5.7   0</span></span>
<span><span class="co">## age.intercept24-35:urban -7.1 0.28       -7.6     -7.1      -6.5 -7.1   0</span></span>
<span><span class="co">## age.intercept36-47:urban -7.6 0.37       -8.3     -7.6      -6.9 -7.6   0</span></span>
<span><span class="co">## age.intercept48-59:urban -8.0 0.46       -8.9     -8.0      -7.1 -8.0   0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slope fixed effect index:</span></span>
<span><span class="co">## time.slope.group1: 0:rural</span></span>
<span><span class="co">## time.slope.group2: 1-11:rural</span></span>
<span><span class="co">## time.slope.group3: 12-23:rural, 24-35:rural, 36-47:rural, 48-59:rural</span></span>
<span><span class="co">## time.slope.group4: 0:urban</span></span>
<span><span class="co">## time.slope.group5: 1-11:urban</span></span>
<span><span class="co">## time.slope.group6: 12-23:urban, 24-35:urban, 36-47:urban, 48-59:urban</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Random Effects</span></span>
<span><span class="co">##            Name             Model</span></span>
<span><span class="co">## 1   time.struct         RW2 model</span></span>
<span><span class="co">## 2 time.unstruct         IID model</span></span>
<span><span class="co">## 3 region.struct        BYM2 model</span></span>
<span><span class="co">## 4    region.int Besags ICAR model</span></span>
<span><span class="co">## 5   st.slope.id         IID model</span></span>
<span><span class="co">## 6     survey.id         IID model</span></span>
<span><span class="co">## ----------------------------------</span></span>
<span><span class="co">## Model hyperparameters</span></span>
<span><span class="co">##                                                     mean       sd 0.025quant</span></span>
<span><span class="co">## overdispersion for the betabinomial observations   0.002    0.001      0.001</span></span>
<span><span class="co">## Precision for time.struct                         89.127  107.545     11.587</span></span>
<span><span class="co">## Precision for time.unstruct                      835.404 3162.330     13.344</span></span>
<span><span class="co">## Precision for region.struct                      362.694 1178.564      7.304</span></span>
<span><span class="co">## Phi for region.struct                              0.347    0.237      0.029</span></span>
<span><span class="co">## Precision for region.int                         662.287 2901.332      6.107</span></span>
<span><span class="co">## Group PACF1 for region.int                         0.898    0.190      0.304</span></span>
<span><span class="co">## Precision for st.slope.id                        106.781  393.439      1.313</span></span>
<span><span class="co">##                                                  0.5quant 0.97quant   mode</span></span>
<span><span class="co">## overdispersion for the betabinomial observations    0.002     0.005  0.002</span></span>
<span><span class="co">## Precision for time.struct                          57.308   338.863 27.622</span></span>
<span><span class="co">## Precision for time.unstruct                       219.625  4806.292 28.959</span></span>
<span><span class="co">## Precision for region.struct                       109.650  2037.244 16.380</span></span>
<span><span class="co">## Phi for region.struct                               0.300     0.844  0.088</span></span>
<span><span class="co">## Precision for region.int                          146.979  3888.536 11.031</span></span>
<span><span class="co">## Group PACF1 for region.int                          0.971     1.000  1.000</span></span>
<span><span class="co">## Precision for st.slope.id                          27.986   615.455  2.528</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">##                                        [,1]</span></span>
<span><span class="co">## log marginal-likelihood (integration) -3454</span></span>
<span><span class="co">## log marginal-likelihood (Gaussian)    -3449</span></span></code></pre>
<p>In this example, we do not have any bias adjustment in this simple
model. If the ratio adjustments to U5MR are known, they could be entered
with the <code>bias.adj</code> and <code>bias.adj.by</code> arguments
when fitting the model.</p>
<p>Posterior samples from the model are taken and summarized using the
<code>getSmoothed</code> function. For models with a large number of
areas and time points, this step may take some time to compute. The
<code>save.draws</code> argument makes it possible to save the raw
posterior draws, so that we can use them again in other functions or
recompute different posterior credible intervals.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit.bb</span>, nsim <span class="op">=</span> <span class="fl">1000</span>, CI <span class="op">=</span> <span class="fl">0.95</span>, save.draws <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ---------------------------------------------</span></span>
<span><span class="co">## Stratified estimates stored in ...$stratified</span></span>
<span><span class="co">## Aggregated estimates stored in ...$overall</span></span>
<span><span class="co">## ---------------------------------------------</span></span>
<span><span class="co">## Estimates computed for 7 time period(s) and 4 area(s)</span></span>
<span><span class="co">## No strata weights has been supplied. Overall estimates are not calculated.</span></span>
<span><span class="co">## Posterior draws are saved in the output. You can use 'getSmoothed(..., draws = ...$draws)' next time to speed up the call.</span></span>
<span><span class="co">## 1000 posterior draws taken.</span></span></code></pre>
<p>For example, to recompute the posterior CI directly using the
existing draws:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.bb.90CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit.bb</span>, nsim <span class="op">=</span> <span class="fl">1000</span>, CI <span class="op">=</span> <span class="fl">0.95</span>, draws <span class="op">=</span> <span class="va">est.bb</span><span class="op">$</span><span class="va">draws</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="aggregation-across-strata">Aggregation across strata<a class="anchor" aria-label="anchor" href="#aggregation-across-strata"></a>
</h3>
<p>The <code>est.bb</code> object above computes the U5MR estimates by
urban/rural strata. In order to obtain the overall region-specific U5MR,
we need additional information on the population fractions of each
stratum within regions. As an demonstration, we simulate the population
totals over the years with</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop.base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"central"</span>, <span class="st">"eastern"</span>, <span class="st">"northern"</span>, <span class="st">"western"</span><span class="op">)</span>,</span>
<span>    strata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"urban"</span>, <span class="st">"rural"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pop.base</span><span class="op">$</span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pop.base</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1000</span>, <span class="fl">20000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">periods.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">periods</span>, <span class="st">"15-19"</span><span class="op">)</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">periods.all</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">pop.base</span></span>
<span>    <span class="va">tmp</span><span class="op">$</span><span class="va">population</span> <span class="op">&lt;-</span> <span class="va">pop.base</span><span class="op">$</span><span class="va">population</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pop.base</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, mean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        sd <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp</span><span class="op">$</span><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">periods.all</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     region strata population years</span></span>
<span><span class="co">## 1  central  urban      16641 85-89</span></span>
<span><span class="co">## 2  eastern  urban       2662 85-89</span></span>
<span><span class="co">## 3 northern  urban       4307 85-89</span></span>
<span><span class="co">## 4  western  urban      13222 85-89</span></span>
<span><span class="co">## 5  central  rural      16821 85-89</span></span>
<span><span class="co">## 6  eastern  rural      17979 85-89</span></span></code></pre>
<p>In order to compute the aggregated estimates, we need the proportion
of urban/rural populations within each region in each time period.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight.strata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"central"</span>, <span class="st">"eastern"</span>, <span class="st">"northern"</span>, <span class="st">"western"</span><span class="op">)</span>,</span>
<span>    years <span class="op">=</span> <span class="va">periods.all</span><span class="op">)</span></span>
<span><span class="va">weight.strata</span><span class="op">$</span><span class="va">urban</span> <span class="op">&lt;-</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">rural</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">weight.strata</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">which.u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">pop</span><span class="op">$</span><span class="va">years</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>        <span class="va">pop</span><span class="op">$</span><span class="va">strata</span> <span class="op">==</span> <span class="st">"urban"</span><span class="op">)</span></span>
<span>    <span class="va">which.r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">pop</span><span class="op">$</span><span class="va">years</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>        <span class="va">pop</span><span class="op">$</span><span class="va">strata</span> <span class="op">==</span> <span class="st">"rural"</span><span class="op">)</span></span>
<span>    <span class="va">weight.strata</span><span class="op">[</span><span class="va">i</span>, <span class="st">"urban"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pop</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">which.u</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">which.u</span><span class="op">]</span> <span class="op">+</span></span>
<span>        <span class="va">pop</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">which.r</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">weight.strata</span><span class="op">[</span><span class="va">i</span>, <span class="st">"rural"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">weight.strata</span><span class="op">[</span><span class="va">i</span>, <span class="st">"urban"</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">weight.strata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     region years rural urban</span></span>
<span><span class="co">## 1  central 85-89  0.50  0.50</span></span>
<span><span class="co">## 2  eastern 85-89  0.87  0.13</span></span>
<span><span class="co">## 3 northern 85-89  0.37  0.63</span></span>
<span><span class="co">## 4  western 85-89  0.36  0.64</span></span>
<span><span class="co">## 5  central 90-94  0.51  0.49</span></span>
<span><span class="co">## 6  eastern 90-94  0.87  0.13</span></span></code></pre>
<p>Now we can recompute the smoothed estimates with the population
fractions.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit.bb</span>, nsim <span class="op">=</span> <span class="fl">1000</span>, CI <span class="op">=</span> <span class="fl">0.95</span>, save.draws <span class="op">=</span> <span class="cn">TRUE</span>, weight.strata <span class="op">=</span> <span class="va">weight.strata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    region years time area variance median mean upper lower rural urban</span></span>
<span><span class="co">## 5 central 85-89    1    1  0.00116   0.23 0.23  0.30  0.17  0.50  0.50</span></span>
<span><span class="co">## 6 central 90-94    2    1  0.00047   0.21 0.21  0.26  0.17  0.51  0.49</span></span>
<span><span class="co">## 7 central 95-99    3    1  0.00027   0.19 0.19  0.23  0.16  0.50  0.50</span></span>
<span><span class="co">## 1 central 00-04    4    1  0.00023   0.18 0.18  0.21  0.15  0.51  0.49</span></span>
<span><span class="co">## 2 central 05-09    5    1  0.00021   0.17 0.17  0.20  0.14  0.50  0.50</span></span>
<span><span class="co">## 3 central 10-14    6    1  0.00030   0.15 0.15  0.18  0.12  0.50  0.50</span></span>
<span><span class="co">##   is.yearly years.num</span></span>
<span><span class="co">## 5     FALSE        NA</span></span>
<span><span class="co">## 6     FALSE        NA</span></span>
<span><span class="co">## 7     FALSE        NA</span></span>
<span><span class="co">## 1     FALSE        NA</span></span>
<span><span class="co">## 2     FALSE        NA</span></span>
<span><span class="co">## 3     FALSE        NA</span></span></code></pre>
<p>We can compare the stratum-specific and aggregated U5MR estimates
now.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">stratified</span>, plot.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">strata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span>, plot.CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Aggregated estimates"</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">+</span> <span class="va">g2</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-26-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="visualizations">Visualizations<a class="anchor" aria-label="anchor" href="#visualizations"></a>
</h2>
<p>There are extensive visualization tools in the package. We can add
hatching to the map visualizations to indicate uncertainty of the
estimates using <code>hatchPlot</code> with similar syntax.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/hatchPlot.html">hatchPlot</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span>,   </span>
<span>        geo <span class="op">=</span> <span class="va">DemoMap</span><span class="op">$</span><span class="va">geo</span>, by.data <span class="op">=</span> <span class="st">"region"</span>, by.geo <span class="op">=</span> <span class="st">"REGNAME"</span>, </span>
<span>        is.long <span class="op">=</span> <span class="cn">TRUE</span>, variables <span class="op">=</span> <span class="st">"years"</span>, values <span class="op">=</span> <span class="st">"median"</span>, </span>
<span>        lower <span class="op">=</span> <span class="st">"lower"</span>, upper <span class="op">=</span> <span class="st">"upper"</span>, hatch <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>        ncol <span class="op">=</span> <span class="fl">4</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, per1000 <span class="op">=</span> <span class="cn">TRUE</span>, legend.label <span class="op">=</span> <span class="st">"U5MR"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-27-1.png" width="90%"></p>
<p>Next we show the posterior densities of the estimates, where each
each panel correspond to one time period, and the regions are ordered by
the posterior median of estimates in the last year (specified by the
<code>order = -1</code> argument).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/ridgePlot.html">ridgePlot</a></span><span class="op">(</span>draws <span class="op">=</span> <span class="va">est.bb</span>, year_plot <span class="op">=</span> <span class="va">periods.all</span>,</span>
<span>                  ncol <span class="op">=</span> <span class="fl">4</span>, per1000 <span class="op">=</span> <span class="cn">TRUE</span>, order <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-28-1.png" width="90%"></p>
<p>It can also be plotted for each region over time as well.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/ridgePlot.html">ridgePlot</a></span><span class="op">(</span>draws <span class="op">=</span> <span class="va">est.bb</span>, year_plot <span class="op">=</span> <span class="va">periods.all</span>,</span>
<span>                  ncol <span class="op">=</span> <span class="fl">4</span>, per1000 <span class="op">=</span> <span class="cn">TRUE</span>, by.year <span class="op">=</span> <span class="cn">FALSE</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-29-1.png" width="90%"></p>
<div class="section level3">
<h3 id="benchmarking-to-external-information">Benchmarking to external information<a class="anchor" aria-label="anchor" href="#benchmarking-to-external-information"></a>
</h3>
<p>When external estimates are available on the national level, we may
want the subnational estimates to aggregate to the national estimates
for internal validation purposes. Methods to benchmark to the national
mean estimates were proposed in the literature. The vignette <em>A Case
Study of Estimating Subnational U5MR using DHS data</em> demonstrates
the approach described in <span class="citation">Li et al. (2019)</span>
for the area-level model. The <code>bias.adj</code> argument in the
<code><a href="../../reference/smoothCluster.html">smoothCluster()</a></code> function allows one to adjust the estimates
if the benchmarking ratio is known, using the approximation methods
described in <span class="citation">Wakefield et al. (2019)</span>. We
refer readers to the package document for more details. Here we
demonstrate a post-processing method described by <span class="citation">Okonek and Wakefield (2022)</span>. It has the
additional advantage that both the mean and uncertainty of the national
estimates are accounted for in the benchmarking process.</p>
<p>To demonstrate the function, we first simulate national estimates.
For a realistic simulation, we reuse the national direct estimates and
add a constant bias term. We assume these estimates are from an external
source. Thus we expect the estimates after benchmarking will be larger
in general.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">national</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>years <span class="op">=</span> <span class="va">periods.all</span>, est <span class="op">=</span> <span class="va">out1</span><span class="op">$</span><span class="va">median</span> <span class="op">+</span> <span class="fl">0.01</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>,</span>
<span>    <span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">national</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   years  est    sd</span></span>
<span><span class="co">## 1 85-89 0.24 0.020</span></span>
<span><span class="co">## 2 90-94 0.23 0.012</span></span>
<span><span class="co">## 3 95-99 0.21 0.025</span></span>
<span><span class="co">## 4 00-04 0.22 0.023</span></span>
<span><span class="co">## 5 05-09 0.20 0.018</span></span>
<span><span class="co">## 6 10-14 0.17 0.025</span></span></code></pre>
<p>In order to perform the benchmarking process, we need the proportion
of population by region over the time periods. We can compute these from
the simulated population before.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight.region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"central"</span>, <span class="st">"eastern"</span>, <span class="st">"northern"</span>, <span class="st">"western"</span><span class="op">)</span>,</span>
<span>    years <span class="op">=</span> <span class="va">periods.all</span><span class="op">)</span></span>
<span><span class="va">weight.region</span><span class="op">$</span><span class="va">proportion</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">weight.region</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">which</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">pop</span><span class="op">$</span><span class="va">years</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">which.year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">years</span> <span class="op">==</span> <span class="va">weight.strata</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">weight.region</span><span class="op">[</span><span class="va">i</span>, <span class="st">"proportion"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">which</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop</span><span class="op">$</span><span class="va">population</span><span class="op">[</span><span class="va">which.year</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">weight.region</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     region years proportion</span></span>
<span><span class="co">## 1  central 85-89      0.410</span></span>
<span><span class="co">## 2  eastern 85-89      0.253</span></span>
<span><span class="co">## 3 northern 85-89      0.084</span></span>
<span><span class="co">## 4  western 85-89      0.253</span></span>
<span><span class="co">## 5  central 90-94      0.413</span></span>
<span><span class="co">## 6  eastern 90-94      0.256</span></span></code></pre>
<p>We perform the benchmarking procedure using the
<code>Benchmark</code> function</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.bb.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Benchmark.html">Benchmark</a></span><span class="op">(</span><span class="va">est.bb</span>, <span class="va">national</span>, weight.region <span class="op">=</span> <span class="va">weight.region</span>, estVar <span class="op">=</span> <span class="st">"est"</span>,</span>
<span>    sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></code></pre></div>
<p>Since the benchmarking procedure is based on a rejection sampler, the
number of posterior draws accepted after benchmarking can be small, as
in this example. We recommend increasing the number of draws first,
i.e.,</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est.bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getSmoothed.html">getSmoothed</a></span><span class="op">(</span><span class="va">fit.bb</span>, nsim <span class="op">=</span> <span class="fl">20000</span>, CI <span class="op">=</span> <span class="fl">0.95</span>, save.draws <span class="op">=</span> <span class="cn">TRUE</span>, weight.strata <span class="op">=</span> <span class="va">weight.strata</span><span class="op">)</span></span>
<span><span class="va">est.bb.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Benchmark.html">Benchmark</a></span><span class="op">(</span><span class="va">est.bb</span>, <span class="va">national</span>, weight.region <span class="op">=</span> <span class="va">weight.region</span>, estVar <span class="op">=</span> <span class="st">"est"</span>,</span>
<span>    sdVar <span class="op">=</span> <span class="st">"sd"</span>, timeVar <span class="op">=</span> <span class="st">"years"</span><span class="op">)</span></span></code></pre></div>
<p>We can compare the posterior median and variance before and after
benchmarking.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">median</span>, <span class="va">est.bb.bench</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">median</span>, xlab <span class="op">=</span> <span class="st">"Before benchmarking"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"After benchmarking"</span>, main <span class="op">=</span> <span class="st">"Posterior median"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">variance</span>, <span class="va">est.bb.bench</span><span class="op">$</span><span class="va">overall</span><span class="op">$</span><span class="va">variance</span>, xlab <span class="op">=</span> <span class="st">"Before benchmarking"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"After benchmarking"</span>, main <span class="op">=</span> <span class="st">"Posterior variance"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-34-1.png" width="100%"></p>
<p>As an sanity check, we can compute the simple weighted average of the
posterior median of all regions to form a set of rough national
estimates. It can be seen that the benchmarked estimates are indeed
higher and closer to the simulated national estimates benchmarked
against.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="va">national</span></span>
<span><span class="va">compare</span><span class="op">$</span><span class="va">before</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">compare</span><span class="op">$</span><span class="va">after</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">compare</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">weight.region</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub</span>, <span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">est.bb.bench</span><span class="op">$</span><span class="va">overall</span>, <span class="va">years</span> <span class="op">==</span> <span class="va">national</span><span class="op">$</span><span class="va">years</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">sub.bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">sub.bench</span>, <span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span>    <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sub.bench</span><span class="op">$</span><span class="va">proportion</span> <span class="op">*</span> <span class="va">sub.bench</span><span class="op">$</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span>, col <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">10</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>,</span>
<span>    <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span>, <span class="va">compare</span><span class="op">$</span><span class="va">after</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"External national estimates"</span>, ylab <span class="op">=</span> <span class="st">"Weighted posterior median after benchmarking"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Sanity check: compare weighted average of area medians to benchmark"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">compare</span><span class="op">$</span><span class="va">est</span>, <span class="va">compare</span><span class="op">$</span><span class="va">before</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Before benchmarking"</span>, <span class="st">"After benchmarking"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-35-1.png" width="100%"></p>
<div class="section level4">
<h4 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h4>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fuglstad2021two" class="csl-entry">
Fuglstad, Geir-Arne, Zehang Richard Li, and Jon Wakefield. 2021.
<span>“The Two Cultures for Prevalence Mapping: Small Area Estimation
and Spatial Statistics.”</span> <em>arXiv Preprint
arXiv:2110.09576</em>.
</div>
<div id="ref-li_etal_19" class="csl-entry">
Li, Zehang R, Yuan Hsiao, Jessica Godwin, Bryan D Martin, Jon Wakefield,
and Samuel J Clark. 2019. <span>“Changes in the Spatial Distribution of
the Under Five Mortality Rate: Small-Area Analysis of 122
<span>DHS</span> Surveys in 262 Subregions of 35 Countries in
<span>A</span>frica.”</span> <em><span>PLoS One</span></em>.
</div>
<div id="ref-li2020space" class="csl-entry">
Martin, Bryan D, Dong Tracy Qi, Geir-Arne Fuglstad, Jessica Godwin, John
Paige, Andrea Riebler, Samuel J Clark, and Jon Wakefield. 2020.
<span>“<a href="https://arxiv.org/abs/2007.05117" class="external-link">Space-Time Smoothing
of Demographic and Health Indicators Using the <span>R</span> Package
<span>SUMMER</span></a>.”</span> <em>Submitted</em>.
</div>
<div id="ref-okonek2022computationally" class="csl-entry">
Okonek, Taylor, and Jon Wakefield. 2022. <span>“A Computationally
Efficient Approach to Fully Bayesian Benchmarking.”</span> <em>arXiv
Preprint arXiv:2203.12195</em>.
</div>
<div id="ref-wakefield_etal_19" class="csl-entry">
Wakefield, J., G.-A. Fuglstad, A. Riebler, J. Godwin, K. Wilson, and S.
J. Clark. 2019. <span>“Estimating Under Five Mortality in Space and Time
in a Developing World Context.”</span> <em>Statistical Methods in
Medical Research</em> 28: 2614–34.
</div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zehang R Li, Bryan D Martin, Yuan Hsiao, Jessica Godwin, John Paige, Peter Gao, Jon Wakefield, Samuel J Clark, Geir-Arne Fuglstad, Andrea Riebler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
